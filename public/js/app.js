(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va={}.hasOwnProperty,wa=function(a,b){function c(){this.constructor=a}for(var d in b)va.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};for(V={host:"bfo2.fly.dev",debug:!1,levelHeight:976,levelWidth:704,levelSpeed:1e3,skins:{body:6,hair:5,head:4,leg:5,shoes:6,skin:5,hat:5,beard:4},player:{jumpMax:2,jumpHeight:82,speed:.17,couchedSpeedRation:.5,fallMinAcceleration:.1,fallMaxAcceleration:.6,fallAcceleration:1.1,jumpMinAcceleration:.2,jumpMaxAcceleration:.6,jumpDeceleration:.9,jumpCurrentAcceleration:0}},s=function(){function a(){this.defineEvents(),this.keys={left:!1,right:!1,up:!1,down:!1}}return a.prototype.defineEvents=function(){var a;return a=[{keys:"left",on_keydown:function(a){return a.preventDefault(),ea.keys.left=!0},on_release:function(){return ea.keys.left=!1}},{keys:"right",on_keydown:function(a){return a.preventDefault(),ea.keys.right=!0},on_release:function(){return ea.keys.right=!1}},{keys:"down",on_keydown:function(a){return a.preventDefault(),ea.keys.down=!0},on_release:function(){return ea.keys.down=!1}},{keys:"up",on_keydown:function(a){return a.preventDefault(),ea.keys.up=!0},on_release:function(){return ea.keys.up=!1}},{keys:"r",on_keydown:function(){if(!ba.writting)return ba.reset()}},{keys:"e",on_keydown:function(){if(!ba.writting)return ba.launch()}},{keys:"enter",on_keydown:function(){return ba.chat()}},{keys:"t",on_keydown:function(){if(!ba.writting&&null!==ha)return ha.useTp()}},{keys:"y",on_keydown:function(){if(!ba.writting&&null!==ha)return ha.useJumpBlock()}},{keys:"g",on_keydown:function(){if(!ba.writting&&null!==ha)return ha.switchJetpack()}}],keypress.register_many(a)},a}(),P=requestAnimationFrame||webkitRequestAnimationFrame||mozRequestAnimationFrame||oRequestAnimationFrame||msRequestAnimationFrame||null,o=function(){function a(){this.writting=!1,this.maxFrameTime=200,this.stats=new Stats,this.stats.setMode(0),document.body.appendChild(this.stats.domElement),this.chatHist=[],this.chatHistLen=5}return a.prototype.loop=function(){var b,c;return this.stats.begin(),c=Date.now(),b=c-this.lastFrame,P(a.prototype.loop.bind(this)),this.lastFrame=c,ba.update(b),this.stats.end()},a.prototype.update=function(a){},a.prototype.draw=function(){},a.prototype.start=function(){return document.querySelector("#login").style.display="none",document.querySelector("#container").style.display="block",document.querySelector("#container").style.bottom=0,document.querySelector("#container").style.position="absolute",this.lastFrame=Date.now(),this.resize(),this.loop()},a.prototype.resize=function(){return document.querySelector("#container").style.left=window.innerWidth/2-V.levelWidth/2+"px",document.querySelector("#container").style.width=V.levelWidth},a.prototype.reset=function(){if(void 0!==ga.socket)return ga.sendReset()},a.prototype.launch=function(){if(void 0!==ga.socket)return ga.sendLaunch()},a.prototype.loadAssets=function(){return W.loadImage({name:"cubes",url:"../assets/cubes.jpg"}),W.loadImage({name:"cubes_red",url:"../assets/cubes_red.jpg"}),W.loadImage({name:"cubes_blue",url:"../assets/cubes_blue.jpg"}),W.loadImage({name:"cubes_green",url:"../assets/cubes_green.jpg"}),W.loadImage({name:"cubes_special",url:"../assets/cubes_special.jpg"}),W.loadImage({name:"effects",url:"../assets/effects.png"}),W.loadImage({name:"bonus",url:"../assets/bonus.png"}),W.loadImage({name:"bg",url:"../assets/bg_grasslands.png"}),W.loadImage({name:"boss",url:"../assets/boss.png"}),W.loadImage({name:"playerSpirteSheet",url:"../assets/playerSpirteSheet.png"}),W.loadImage({name:"pidgeon",url:"../assets/pidgeon.png"}),W.loadSound({name:"beep",url:"../assets/sounds/beep.wav",type:"effect"}),W.loadSound({name:"death",url:"../assets/sounds/death.wav",type:"effect"}),W.loadSound({name:"explosion",url:"../assets/sounds/explosion.wav",type:"effect"}),W.loadSound({name:"pickup",url:"../assets/sounds/pickup.wav",type:"effect"}),W.loadSound({name:"music1",url:"../assets/sounds/music/mysterytheme.ogg",type:"music",title:"Chy - Mystery Theme"}),W.loadSound({name:"music2",url:"../assets/sounds/music/couragetheme.ogg",type:"music",title:"Chy - Courage Theme"}),W.loadSound({name:"music3",url:"../assets/sounds/music/shytheme.ogg",type:"music",title:"Chy - Shy Theme"}),W.loadSound({name:"music4",url:"../assets/sounds/music/powertheme.ogg",type:"music",title:"Chy - Power Theme"}),W.load()},a.prototype.chat=function(){return"chatMessage"===document.activeElement.id?(this.writting=!1,void 0!==document.activeElement.value&&""!==document.activeElement.value.trim()&&(ga.sendMessage(document.getElementById("chatMessage").value),"/"!==document.getElementById("chatMessage").value[0]&&this.addMessage(-1,document.getElementById("chatMessage").value)),document.getElementById("chatMessage").blur(),document.getElementById("chatMessage").value=null,this.openHist(3e3)):(this.writting=!0,this.openHist(1e5),document.getElementById("chatMessage").focus())},a.prototype.addMessage=function(a,b){var c,d;if(W.play("beep"),c=null===a?"Server":-1===a?"You":ga.players[a].name.getText(),this.chatHist.push([c,b]),this.chatHist.length>this.chatHistLen&&this.chatHist.shift(),this.composeHistoric(),-1!==a)return d=5e3+30*b.length,this.openHist(d)},a.prototype.composeHistoric=function(){var a,b,c,d,e,f,g,h,i;for(document.getElementById("chatHistoric").innerHTML="",h=this.chatHist,i=[],b=f=0,g=h.length;f<g;b=++f)a=h[b],d=this.escapeHtml(a[0]),e="Server"===d?"server":"You"===d?"you":"other",c=this.escapeHtml(a[1]),i.push(document.getElementById("chatHistoric").innerHTML+='<div class="message '+e+'"><span class="from">'+d+':</span><span class="content">'+c+"</span></div>");return i},a.prototype.escapeHtml=function(a){var b;return b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},a.replace(/[&<>"'\/]/g,function(a){return b[a]})},a.prototype.openHist=function(a){return void 0!==this.closeTime&&clearInterval(this.closeTime),this.closeTime=setTimeout(this.closeHist,a),document.querySelector("#chatHistoric").style.display="block"},a.prototype.closeHist=function(){return document.querySelector("#chatHistoric").style.display="none"},a.prototype.config=function(){return document.querySelector("#login-loading").style.display="none",document.querySelector("#config").style.display="block"},a}(),g=function(){function a(){this.imagesToLoad=[],this.soundsToLoad=[],this.images=[],this.sounds=[],this.volumeStep=.01,this.count=0,this.total=0,this.musics=0,this.currentSong,this.oldSoundLevel=0,this.oldMusicLevel=0}return a.prototype.loadImage=function(a){return this.imagesToLoad.push(a)},a.prototype.loadSound=function(a){return this.soundsToLoad.push(a)},a.prototype.load=function(){var a,b,c,d,e,f,g,h,i,j,k,l;for(d=this,this.total=this.imagesToLoad.length+this.soundsToLoad.length,j=this.imagesToLoad,f=0,h=j.length;f<h;f++)c=j[f],b=new Image,b.src=c.url,this.images[c.name]=b,b.onload=function(){return d.updateLoader(this.src)};for(k=this.soundsToLoad,l=[],g=0,i=k.length;g<i;g++)e=k[g],a=new Audio,a.src=e.url,a.volume=.1,void 0!==e.title&&(a.title=e.title),this.sounds[e.name]=a,a.oncanplaythrough=function(){return d.updateLoader(this.src)},"music"===e.type?(this.musics++,l.push(a.addEventListener("ended",function(){return d.nextSong()}))):l.push(void 0);return l},a.prototype.updateLoader=function(a){var b,c;if(this.count<this.total&&(this.count++,c=a.split("/"),b=c[c.length-1],document.querySelector("#login-loading").innerHTML="Loading ... <br> "+b+"<br>"+Math.round(this.count/this.total*100)+"%",this.count===this.total))return this.contentsLoaded(),document.querySelector("#login-loading").innerHTML=""},a.prototype.contentsLoaded=function(){},a.prototype.muteEffect=function(){var a,b,c,d;for(d=this.soundsToLoad,b=0,c=d.length;b<c;b++)a=d[b],"effect"===a.type&&(this.oldSoundLevel=Math.floor(100*this.sounds[a.name].volume)/100,this.sounds[a.name].volume=0);return document.querySelector("#sound-effect").innerHTML=0},a.prototype.muteMusic=function(){var a,b,c,d;for(d=this.soundsToLoad,b=0,c=d.length;b<c;b++)a=d[b],"music"===a.type&&(this.oldMusicLevel=Math.floor(100*this.sounds[a.name].volume)/100,this.sounds[a.name].volume=0);return document.querySelector("#sound-music").innerHTML=0},a.prototype.unmuteEffect=function(){var a,b,c,d;for(d=this.soundsToLoad,b=0,c=d.length;b<c;b++)a=d[b],"effect"===a.type&&(this.sounds[a.name].volume=this.oldSoundLevel);return document.querySelector("#sound-effect").innerHTML=100*this.oldSoundLevel},a.prototype.unmuteMusic=function(){var a,b,c,d;for(d=this.soundsToLoad,b=0,c=d.length;b<c;b++)a=d[b],"music"===a.type&&(this.sounds[a.name].volume=this.oldMusicLevel);return document.querySelector("#sound-music").innerHTML=100*this.oldMusicLevel},a.prototype.addVolumeEffect=function(){var a,b,c,d,e,f;for(e=this.soundsToLoad,f=[],c=0,d=e.length;c<d;c++)a=e[c],"effect"===a.type&&(b=this.sounds[a.name].volume+this.volumeStep,b<=1?this.sounds[a.name].volume=b:(b=1,this.sounds[a.name].volume=b)),document.querySelector("#sound-effect").innerHTML=Math.floor(100*b),f.push(document.querySelector("#sound-mute-effect").className="un-muted");return f},a.prototype.addVolumeMusic=function(){var a,b,c,d,e;for(e=this.soundsToLoad,c=0,d=e.length;c<d;c++)a=e[c],"music"===a.type&&(b=this.sounds[a.name].volume+this.volumeStep,b<=1?this.sounds[a.name].volume=b:(b=1,this.sounds[a.name].volume=b));return document.querySelector("#sound-music").innerHTML=Math.floor(100*b),document.querySelector("#sound-mute-music").className="un-muted"},a.prototype.lessVolumeEffect=function(){var a,b,c,d,e,f;for(e=this.soundsToLoad,f=[],c=0,d=e.length;c<d;c++)a=e[c],"effect"===a.type&&(b=this.sounds[a.name].volume-this.volumeStep,b>=0?this.sounds[a.name].volume=b:(b=0,this.sounds[a.name].volume=b,document.querySelector("#sound-mute-effect").className="muted")),f.push(document.querySelector("#sound-effect").innerHTML=Math.floor(100*b));return f},a.prototype.lessVolumeMusic=function(){var a,b,c,d,e;for(e=this.soundsToLoad,c=0,d=e.length;c<d;c++)a=e[c],"music"===a.type&&(b=this.sounds[a.name].volume-this.volumeStep,b>=0?this.sounds[a.name].volume=b:(b=0,this.sounds[a.name].volume=b,document.querySelector("#sound-mute-music").className="muted"));return document.querySelector("#sound-music").innerHTML=Math.floor(100*b)},a.prototype.play=function(a){return this.sounds[a].pause(),this.sounds[a].currentTime=0,this.sounds[a].play()},a.prototype.playMusic=function(a){return this.sounds[a].pause(),this.sounds[a].currentTime=0,this.sounds[a].play(),document.querySelector("#current-music").innerHTML=this.sounds[a].title},a.prototype.playSong=function(){var a;return a=Math.floor(Math.random()*this.musics+1),this.currentSong=a,this.playMusic("music"+a)},a.prototype.nextSong=function(){return this.sounds["music"+this.currentSong].pause(),this.currentSong++,void 0!==this.sounds["music"+this.currentSong]?this.playMusic("music"+this.currentSong):(this.playMusic("music1"),this.currentSong=1)},a.prototype.prevSong=function(){return this.sounds["music"+this.currentSong].pause(),this.currentSong--,void 0!==this.sounds["music"+this.currentSong]?this.playMusic("music"+this.currentSong):(this.currentSong=this.musics,this.playMusic("music"+this.currentSong))},a.prototype.setEffectVolume=function(a){var b,c,d,e;for(e=this.soundsToLoad,c=0,d=e.length;c<d;c++)b=e[c],"effect"===b.type&&(this.sounds[b.name].volume=a/100);if(document.querySelector("#sound-effect").innerHTML=a,0===parseInt(a))return document.querySelector("#sound-mute-effect").className="muted",this.oldSoundLevel=.1},a.prototype.setMusicVolume=function(a){var b,c,d,e;for(e=this.soundsToLoad,c=0,d=e.length;c<d;c++)b=e[c],"music"===b.type&&(this.sounds[b.name].volume=a/100);if(document.querySelector("#sound-music").innerHTML=a,0===parseInt(a))return document.querySelector("#sound-mute-music").className="muted",this.oldMusicLevel=.1},a.prototype.setBG=function(a){return"White"===a?(document.querySelector("body").style.background="White",document.querySelector("#sound-controller").style.color="Black",document.querySelector("#color-switch a").innerHTML="White"):(document.querySelector("body").style.background="Black",document.querySelector("#sound-controller").style.color="White",document.querySelector("#color-switch a").innerHTML="Black")},a.prototype.changeBG=function(){var a;return a=document.querySelector("#color-switch a").innerHTML,"White"===a?(document.querySelector("body").style.background="Black",document.querySelector("#sound-controller").style.color="White",document.querySelector("#color-switch a").innerHTML="Black"):(document.querySelector("body").style.background="White",document.querySelector("#sound-controller").style.color="Black",document.querySelector("#color-switch a").innerHTML="White")},a}(),f=function(){function a(){}return a.prototype.getBoundBox=function(a){return{top:a.getY(),bottom:a.getY()+a.getHeight(),left:a.getX(),right:a.getX()+a.getWidth()}},a.prototype.colliding=function(a,b){return!(a.left>=b.right||a.right<=b.left||a.top>=b.bottom||a.bottom<=b.top)},a.prototype.collidingCorners=function(a,b){return(b.right>=a.left&&b.right<a.right&&b.top>=a.top&&b.top<a.bottom||b.left>=a.left&&b.left<a.right&&b.top>=a.top&&b.top<a.bottom)&&a.top>b.top-5},a.prototype.isCubeGrabbable=function(a,b){if(b.getX()>a.getX()){if(this.pointInCube(b,{x:a.getX()+16,y:a.getY()+80}))return!1}else if(this.pointInCube(b,{x:a.getX()-16,y:a.getY()+80}))return!1;return!0},a.prototype.getAllCollisions=function(a){return this.getStaticCollisions(a).concat(this.getDynamicCollisions(a))},a.prototype.getStaticCollisions=function(a){var b,c,d;return c=[],d=this.getBoundBox(a),b=ra.find("Sprite"),b.each(function(a){var b;if(b=U.getBoundBox(a),U.colliding(d,b))return c.push(a)}),c},a.prototype.getDynamicCollisions=function(a){var b,c,d;return c=[],d=this.getBoundBox(a),b=aa.find("Sprite"),b.each(function(a){var b;if(b=U.getBoundBox(a),U.colliding(d,b))return c.push(a)}),c},a.prototype.getCubeCollisions=function(a){var b,c,d;return c=[],d=this.getBoundBox(a),b=aa.find("Sprite"),b.each(function(b){var e;if(a._id!==b._id&&void 0!==b.getName()&&null!==b.getName()&&"cube"===b.getName().type&&!b.getName().falling&&(e=U.getBoundBox(b),U.colliding(d,e)))return c.push(b)}),c.concat(this.getStaticCollisions(a))},a.prototype.getPlayerSkin=function(a){return ja.find("#skin-"+a.getId())[0]},a.prototype.getPlayerCollision=function(){var a,b;return b=!1,a=U.getBoundBox(ha.shape),ja.find("Rect").each(function(c){var d,e;if(void 0!==c.getId()&&void 0!==(e=U.getPlayerSkin(c))&&"otherPlayer"===c.getName()&&"couch"===e.getAnimation()&&(d=U.getBoundBox(c),U.colliding(a,d)))return b=!0}),b},a.prototype.getCornerCollisions=function(){var a,b,c;return c=[],b=this.getBoundBox(ha.shape),b.left-=4,b.right+=4,a=aa.find("Sprite"),a.each(function(a){var d;if(!a.getName().falling&&"cube"===a.getName().type&&(d=U.getBoundBox(a),U.colliding(b,d)&&(d.left<b.left&&-1===ha.skin.getScaleX()||d.left>b.left&&1===ha.skin.getScaleX())&&U.collidingCorners(b,d)&&U.isCubeGrabbable(a,ha.shape)))return c.push(a)}),c},a.prototype.pointInCube=function(a,b){return b[0]>=a.getX()&&b[0]<a.getX()+a.getWidth()&&b[1]>=a.getY()&&b[1]<a.getY()+a.getHeight()},a}(),ia=[{id:1,name:"idle"},{id:2,name:"jump"},{id:3,name:"fall"},{id:4,name:"run"},{id:5,name:"couch"},{id:6,name:"couchMove"},{id:7,name:"grabbing"},{id:8,name:"dead"}],B=function(){function a(a){var b,c;this.heightCouched=30,this.height=62,this.draw(),c=this,b=function(a){return c.skin.setImage(a),c.fixSkinPos()},na.createSkin(a,b,c.skin._id)}return a.prototype.draw=function(){return this.shape=new Kinetic.Rect({width:22,height:62}),ja.add(this.shape),this.skin=new L(0,0,M.SMALL,"playerSpirteSheet","fall").shape,ja.add(this.skin),this.skin.start(),this.spawn()},a.prototype.spawn=function(){if(this.shape.setX(336),this.shape.setY(-1*pa.getY()-224),this.shape.setHeight(this.height),this.skin.getImage()!==this.playerSkin)return this.skin.setImage(this.playerSkin)},a.prototype.reset=function(){return this.spawn(),R.resetBonuses()},a.prototype.resurection=function(){if(!this.alive)return this.reset()},a.prototype.fixSkinPos=function(){return-1===this.skin.getScale().x?this.skin.setX(this.shape.getX()-12+48):this.skin.setX(this.shape.getX()-12),"couch"===this.skin.getAnimation()||"couchMove"===this.skin.getAnimation()?this.skin.setY(this.shape.getY()-34):this.skin.setY(this.shape.getY()-2)},a.prototype.changeAnimation=function(a){var b;if(b=this.getAnimationByIndex(a),this.skin.getAnimation()!==b)return this.skin.setAnimation(b),this.fixSkinPos()},a.prototype.changeSide=function(a){return-1===a?(this.skin.setScale({x:-1,y:1}),this.skin.setX(this.skin.getX()+48)):1===a?(this.skin.setScale({x:1,y:1}),this.skin.setX(this.skin.getX()-48)):void 0},a.prototype.getAnimationByIndex=function(a){var b,c,d;for(c=0,d=ia.length;c<d;c++)if(b=ia[c],b.id===a)return b.name},a.prototype.getIndexByAnimation=function(a){var b,c,d;for(c=0,d=ia.length;c<d;c++)if(b=ia[c],b.name===a)return b.id},a}(),h=function(a){function b(a){b.__super__.constructor.call(this,a),this.initStats()}return wa(b,a),b.prototype.initStats=function(){return this.speed=V.player.speed+R.findBonus("speedBonus").value*R.playerBonuses.speedBonus,this.jumpHeight=V.player.jumpHeight+R.findBonus("jumpHeightBonus").value*R.playerBonuses.jumpHeightBonus,this.jumpMax=V.player.jumpMax,this.couchedSpeedRatio=V.player.couchedSpeedRation,this.fallMinAcceleration=V.player.fallMinAcceleration,this.fallMaxAcceleration=V.player.fallMaxAcceleration,this.fallAcceleration=V.player.fallAcceleration,this.jumpMinAcceleration=V.player.jumpMinAcceleration,this.jumpMaxAcceleration=V.player.jumpMaxAcceleration,this.jumpDeceleration=V.player.jumpDeceleration,this.jumpCurrentAcceleration=V.player.jumpCurrentAcceleration,this.fallCurrentAcceleration=this.fallMinAcceleration,this.actualCollisions=[],this.cached={},this.moveVector={x:0,y:0},this.reinitStats()},b.prototype.reinitStats=function(){return this.jump=!1,this.canJump=!0,this.jumpStart=0,this.jumpCount=0,this.couched=!1,this.falling=!0,this.grabbing=!1,this.grabbed=!1,this.coopJump=!1,this.alive=!0,this.stomped=!1,this.forceJump=!1,this.jetpackMode=!1,this.setInvulnerable()},b.prototype.reset=function(){return R.resetBonuses(),this.spawn(),this.initStats(),ga.sendRez()},b.prototype.resurect=function(){var a,b;return b=this,a=function(){return b.spawn(),b.reinitStats(),ga.sendRez()},setTimeout(a,200)},b.prototype.update=function(a){var b,c,d;if((this.alive||!(this.shape.getY()>-1*pa.getY()+pa.getHeight()))&&(this.sliding||(this.moveVector.x=0),this.sliding=!1,this.slowed=!1,this.testMove(0,this.shape.getY())||(this.falling=!0),this.jump||this.grabbing?ea.keys.up||this.forceJump?this.doJump(a):this.stopJump():this.doFall(a),d=this.couched&&!this.jump?this.speed*a*this.couchedSpeedRatio:this.speed*a,this.slowed&&(d/=2,this.canJump=!1),this.alive?(c=0,this.shape.getY()>1e3&&this.kill(),ea.keys.left?(this.moveVector.x=-1,b=this.testMove(this.shape.getX()-d,0),b&&this.shape.setX(b.getX()+b.getWidth()),-1!==c&&(c=-1)):ea.keys.right&&(this.moveVector.x=1,b=this.testMove(this.shape.getX()+d,0),b&&this.shape.setX(b.getX()-this.shape.getWidth()),1!==c&&(c=1)),ea.keys.up?R.playerBonuses.jetpackBonus>0&&this.jetpackMode?this.useJetpack(a):this.canJump&&this.startJump():this.canJump=!0,!ea.keys.down||this.falling||this.jump?this.stopCouch():this.startCouch(),this.jump?this.changeAnimation("jump"):this.grabbing?this.changeAnimation("grabbing"):this.falling?this.changeAnimation("fall"):this.couched?0!==c?this.changeAnimation("couchMove"):this.changeAnimation("couch"):0!==c?this.changeAnimation("run"):this.changeAnimation("idle"),this.getCornerCollisions(),-1===c&&-1!==this.skin.getScaleX()?this.changeSide(-1):1===c&&1!==this.skin.getScaleX()&&this.changeSide(1)):this.changeAnimation("dead"),this.fixSkinPos(),this.cached.x===this.shape.getX()&&this.cached.y===this.shape.getY()&&this.cached.animation===this.skin.getAnimation()||(ga.sendMove(this.shape.getX(),this.shape.getY()),this.cached.x=this.shape.getX(),this.cached.y=this.shape.getY(),this.cached.animation=this.skin.getAnimation()),this.sliding))if(-1===this.skin.getScaleX()){if(this.moveVector.x=-1,b=this.testMove(this.shape.getX()-this.speed*a/2,0))return this.shape.setX(b.getX()+b.getWidth())}else if(this.moveVector.x=1,b=this.testMove(this.shape.getX()+this.speed*a/2,0))return this.shape.setX(b.getX()-this.shape.getWidth())},b.prototype.doFall=function(a){var b,c;return 0===this.jumpCount&&(this.jumpCount=1),b=this.testMove(0,this.shape.getY()+this.fallCurrentAcceleration*a),c=this.fallCurrentAcceleration*this.fallAcceleration,c<=this.fallMaxAcceleration?this.fallCurrentAcceleration=c:this.fallCurrentAcceleration=this.fallMaxAcceleration,b?this.stopFall(b.getY()):this.falling=!0},b.prototype.stopFall=function(a){return this.shape.setY(a-this.shape.getHeight()),this.jumpCount=0,this.fallCurrentAcceleration=this.fallMinAcceleration,this.falling=!1,this.setVulnerable()},b.prototype.startJump=function(){if(this.canJump=!1,!this.couched&&0===this.jumpCount||this.jumpCount<this.jumpMax&&R.playerBonuses.doubleJumpBonus>0)return this.jumpCount>0&&R.playerBonuses.doubleJumpBonus--,U.getPlayerCollision()&&(this.coopJump=!0,this.setTempJumpHeight(this.jumpHeight+40)),this.jumpCount++,this.jump=!0,this.jumpCurrentAcceleration=this.jumpMaxAcceleration,this.jumpStart=this.shape.getY()},b.prototype.doJump=function(a){var b,c;return this.jumpStart-this.shape.getY()<this.jumpHeight&&this.jump?(b=this.testMove(0,this.shape.getY()-this.jumpCurrentAcceleration*a),c=this.jumpCurrentAcceleration*this.jumpDeceleration,c>=this.jumpMinAcceleration?this.jumpCurrentAcceleration=c:this.jumpCurrentAcceleration=this.jumpMinAcceleration,b&&(this.shape.setY(b.getY()+b.getHeight()),this.stopJump()),this.jumpTime+=a):this.stopJump()},b.prototype.stopJump=function(){if(this.jump=!1,this.falling=!0,this.stomped||this.coopJump||this.forceJump)return this.forceJump=!1,this.reinitJump()},b.prototype.reinitJump=function(){return this.jumpHeight=this.oldStats.jumpHeight,this.jumpMaxAcceleration=this.oldStats.jumpMaxAcceleration,this.stomped=!1,this.coopJump=!1},b.prototype.startCouch=function(){if(!this.couched&&!this.grabbing)return this.couched=!0,this.shape.setHeight(this.heightCouched),this.shape.setY(this.shape.getY()+this.height-this.heightCouched)},b.prototype.stopCouch=function(){if(this.couched&&(this.couched=!1,this.shape.setHeight(this.height),this.testMove(0,this.shape.getY()-this.height+this.heightCouched)))return this.startCouch()},b.prototype.testMove=function(a,b){var c,d,e,f;for(0!==a&&this.shape.setX(a),0!==b&&this.shape.setY(b),d=U.getAllCollisions(this.shape),e=0,f=d.length;e<f;e++){if(c=d[e],void 0===c.getName()||null===c.getName())return c;if("bonus"===c.getName().type&&this.alive&&this.takeBonus(c),"boss"===c.getName().type&&this.collideBoss(c),"effect"===c.getName().type&&this.collideEffect(c),"cube"===c.getName().type||"special"===c.getName().type)return c.getName().falling&&c.getY()+c.getHeight()-16<this.shape.getY()&&this.kill(),c}return!1},b.prototype.takeBonus=function(a){if(R.getBonus(a.getName().name))return a.destroy(),ga.sendBonusTaken(a.getId())},b.prototype.changeAnimation=function(a){if(this.skin.getAnimation()!==a)return this.skin.setAnimation(a),ga.sendAnimation(this.getIndexByAnimation(a))},b.prototype.changeSide=function(a){return b.__super__.changeSide.call(this,a),ga.sendAnimationSide(a)},b.prototype.collideBoss=function(){return this.kill()},b.prototype.collideEffect=function(a){if("ice"===a.getName().name&&0!==this.moveVector.x&&(this.sliding=!0),"slow"===a.getName().name&&(this.slowed=!0),"jumpBlock"===a.getName().name&&this.falling&&!this.jump)return this.invulnerable&&this.setVulnerable(),this.setTempJumpHeight(256),this.jumpStart=ha.shape.getY(),this.jumpCount=ha.jumpMax,this.stomped=!0,this.jump=!0,this.forceJump=!0},b.prototype.getCornerCollisions=function(){var a,b,c,d,e,f;for(c=!1,b=U.getCornerCollisions(),d=U.getPlayerCollision(),e=0,f=b.length;e<f;e++){if(a=b[e],d){this.grab(a,!1),c=!0;break}if(R.playerBonuses.grabbingBonus>0){this.grab(a,!0),c=!0;break}}if(!c)return this.grabbing=!1,this.stopGrab()},b.prototype.grab=function(a,b){if(!this.grabbing&&(this.stopJump(),this.grabbing=!0,this.jumpCount=0,this.shape.setY(a.getY()),b))return this.grabbed=!0},b.prototype.stopGrab=function(){if(this.grabbed)return R.playerBonuses.grabbingBonus--,this.grabbed=!1},b.prototype.kill=function(){if(!this.invulnerable&&this.alive)return this.alive=!1,W.play("death"),new k(this.shape.getX()-16,this.shape.getY(),M.SMALL,"blood",!0),R.playerBonuses.autoRezBonus>0?(R.playerBonuses.autoRezBonus--,this.resurect()):(this.lootBonus(),R.resetBonuses(),ga.sendDie())},b.prototype.lootBonus=function(){var a;if(void 0!==(a=R.getRandomBonus()))return ga.sendLootBonus(32*Math.round(this.shape.getX()/32),32*Math.floor((this.shape.getY()+this.shape.getHeight())/32)-32,a)},b.prototype.addJumpHeight=function(a){return this.jumpHeight+=a,this.jumpMaxAcceleration+=a/200},b.prototype.setTempJumpHeight=function(a){return this.oldStats={jumpHeight:this.jumpHeight,jumpMaxAcceleration:this.jumpMaxAcceleration},this.jumpHeight=a,this.jumpMaxAcceleration=a/200,this.jumpCurrentAcceleration=this.jumpMaxAcceleration},b.prototype.useTp=function(){if(R.playerBonuses.tpBonus>0)return R.playerBonuses.tpBonus--,ga.sendTp(),new k(this.shape.getX()-24,this.shape.getY(),M.SMALL,"tp",null,!0)},b.prototype.useJumpBlock=function(){if(R.playerBonuses.jumpBlockBonus>0)return R.playerBonuses.jumpBlockBonus--,ga.sendJumpBlock(32*Math.round(this.shape.getX()/32),32*Math.floor((this.shape.getY()+this.shape.getHeight())/32)-32)},b.prototype.setInvulnerable=function(){return this.invulnerable=!0,this.skin.setOpacity(.75)},b.prototype.setVulnerable=function(){return this.invulnerable=!1,this.skin.setOpacity(1)},b.prototype.useJetpack=function(a){var b;return b=.8,this.testMove(0,this.shape.getY()-b*a),R.playerBonuses.jetpackBonus-a<0?R.playerBonuses.jetpackBonus=0:R.playerBonuses.jetpackBonus-=a},b.prototype.switchJetpack=function(){if(R.playerBonuses.jetpackBonus>0)return this.jetpackMode?this.jetpackMode=!1:this.jetpackMode=!0},b.prototype.getJetpackText=function(){return this.jetpackMode?"On":"Off"},b}(B),O=function(a){function b(a,c,d){b.__super__.constructor.call(this,d),this.skin.setFill("white"),this.shape.setName("otherPlayer"),this.shape.setId(a),this.skin.setId("skin-"+a),this.skin.setOpacity(.5),this.name=new Kinetic.Text({text:c,fill:"black",fontFamily:"Calibri",fontSize:18}),ja.add(this.name)}return wa(b,a),b.prototype.move=function(a,b){return this.shape.setX(a),this.shape.setY(b),this.name.setX(a),this.name.setY(b-20),this.fixSkinPos()},b.prototype.remove=function(){return this.shape.destroy(),this.skin.destroy(),this.name.destroy(),true},b.prototype.kill=function(){return W.play("death"),new k(this.shape.getX()-16,this.shape.getY(),M.SMALL,"blood",!0)},b}(B),M={SMALL:{x:32,y:32},MEDIUM:{x:64,y:64},LARGE:{x:128,y:128},MEDIUM_RECT:{x:64,y:32},LARGE_RECT:{x:128,y:64},LONG_RECT:{x:32,y:128},BONUS:{x:20,y:20},EFFECT:{x:32,y:12},HALF_SMALL:{x:32,y:16}},oa={idle:[288,0,48,64],jump:[336,0,48,64],fall:[384,0,48,64],run:[0,0,48,64,48,0,48,64,96,0,48,64,144,0,48,64,192,0,48,64,240,0,48,64],couch:[0,64,48,64],couchMove:[48,64,48,64,96,64,48,64,144,64,48,64,192,64,48,64,240,64,48,64],grabbing:[0,128,48,64],dead:[288,64,48,64],"32-32":[192,96,32,32],"64-64":[128,64,64,64],"128-128":[0,0,128,128],"64-32":[192,64,64,32],"128-64":[128,0,128,64],"32-128":[256,0,32,128],brokenCube:[224,96,32,32],iceExplosion:[0,0,64,64],explosion:[64,0,64,64],ice:[0,0,32,12],stompblock:[128,0,64,64],swapblock:[128,64,64,64],tpblock:[64,64,64,64],randblock:[0,128,64,64],randomEvent:[64,128,64,64],slowblock:[0,64,64,64],jumpBlock:[64,0,32,32],blood:[160,0,64,64,224,0,64,64,288,0,64,64,352,0,64,64,416,0,64,64,480,0,64,64],explosionEffect:[0,32,160,128,160,32,160,128,320,32,160,128,480,32,160,128,0,160,160,128,160,160,160,128,320,160,160,128,480,160,160,128,0,288,160,128,160,288,160,128],iceExplosionEffect:[0,416,160,128,160,416,160,128,320,416,160,128,480,416,160,128,0,544,160,128,160,544,160,128,320,544,160,128,480,544,160,128,0,672,160,128,160,672,160,128],slow:[32,0,32,12],bioExplosion:[0,834,128,128,128,834,128,128,256,834,128,128,384,834,128,128,512,834,128,128,640,834,128,128],missileEffect:[0,32,32,32,32,32,32,32,64,32,32,32],smallExplosionEffect:[0,960,64,64,64,960,64,64,128,960,64,64,192,960,64,64,0,1024,64,64,64,1024,64,64,128,1024,64,64,192,1024,64,64,0,1088,64,64,64,1088,64,64],speedBonus:[64,32,32,32],jumpHeightBonus:[32,32,32,32],doubleJumpBonus:[0,64,32,32],grabbingBonus:[0,0,32,32],resurectionBonus:[96,0,32,32],autoRezBonus:[96,32,32,32],tpBonus:[64,0,32,32],jumpBlockBonus:[0,32,32,32],tp:[32,0,32,32],jetpackBonus:[32,64,32,32],jetpackOffBonus:[64,64,32,32],roueman:[0,0,64,64,64,0,64,64],freezeman:[0,65,544,30],poingman:[192,0,64,64],labiman:[128,0,64,64],sparkman:[0,96,64,64,64,96,64,64,128,96,64,64,192,96,64,64],spark:[0,160,32,32,32,160,32,32,64,160,32,32,96,160,32,32],homingman:[256,0,64,64],missileman:[320,0,32,64],phantom:[128,160,32,32],fly:[0,0,32,32,32,0,32,32,64,0,32,32]},L=function(){function a(a,b,c,d,e){this.shape=new Kinetic.Sprite({x:a,y:b,width:c.x,height:c.y,image:W.images[d],animation:e,animations:oa,frameRate:7,index:0})}return a.prototype.getSpriteSheet=function(){var a;return a=["cubes_red","cubes_green","cubes_blue"],a[Math.floor(Math.random()*a.length)]},a}(),l=function(a){function b(a,c){var d,e,f;e=32*a+160,f=-1*pa.getY(),d=c.x+"-"+c.y,b.__super__.constructor.call(this,e,f,c,this.getSpriteSheet(),d),aa.add(this.shape),this.shape.setName({type:"cube",falling:!0}),this.shape.draw()}return wa(b,a),b}(L),N=function(a){function b(a,c,d){var e;e=d.x+"-"+d.y,b.__super__.constructor.call(this,a,c,d,"cubes",e),ra.add(this.shape),this.shape.draw()}return wa(b,a),b}(L),K=["iceExplosion","slowblock","stompblock","swapblock","tpblock","randblock"],J=function(a){function b(a,c,d,e){var f,g,h;g=32*a+160,h=-1*pa.getY(),this.type=K[d],b.__super__.constructor.call(this,g,h,c,"cubes_special",this.type),aa.add(this.shape),void 0!==e?(f=K[e],this.shape.setName({type:"special",falling:!0,randType:f})):this.shape.setName({type:"special",falling:!0}),this.shape.setId(this.type),this.shape.draw()}return wa(b,a),b}(L),ka=["resurection","bonuses","tp"],D=function(a){function b(a){var c,d,e,f;e=pa.getWidth()/2-32,f=-1*pa.getY()-64,this.type=ka[a],b.__super__.constructor.call(this,e,f,M.MEDIUM,"cubes_special","randomEvent"),aa.add(this.shape),this.shape.setName({type:"event",randType:this.type}),this.shape.draw(),c=this,d=new Kinetic.Tween({node:this.shape,duration:1,y:Q.y-fa.levelHeight-640,onFinish:function(){return c.doEvent()}}),d.play(),X.tweens.push(d)}return wa(b,a),b.prototype.doEvent=function(){var a;return W.play("explosion"),a=this.shape.getName().randType,"resurection"===a?(ha.resurection(),new k(this.shape.getX(),this.shape.getY(),M.SMALL,"resurectionBonus",null,!0)):"bonuses"===a?new k(this.shape.getX(),this.shape.getY(),M.SMALL,"speedBonus",null,!0):"tp"===a&&(ha.shape.setX(this.shape.getX()+16),ha.shape.setY(this.shape.getY()-448),ha.setInvulnerable(),new k(this.shape.getX(),this.shape.getY(),M.SMALL,"tp",null,!0)),this.shape.destroy()},b}(L),i=function(a){function b(a,c,d){var e;e=d.x+"-"+d.y,b.__super__.constructor.call(this,a,c,d,this.getSpriteSheet(),e),aa.add(this.shape),this.shape.setName({type:"cube"}),this.shape.draw()}return wa(b,a),b}(L),S=[{id:1,name:"speedBonus"},{id:2,name:"jumpHeightBonus"},{id:3,name:"doubleJumpBonus"},{id:4,name:"grabbingBonus"},{id:5,name:"resurectionBonus"},{id:6,name:"autoRezBonus"},{id:7,name:"tpBonus"},{id:8,name:"jumpBlockBonus"},{id:9,name:"jetpackBonus"}],b=function(a){function b(a,c,d){var e,f,g,h,i,j;for(e="",i=0,j=S.length;i<j;i++)f=S[i],c===f.id&&(e=f.name);g=32*a+160+6,h=-1*pa.getY(),b.__super__.constructor.call(this,g,h,M.BONUS,"bonus",e),aa.add(this.shape),this.shape.setId("bonus"+d),this.shape.setName({type:"bonus",name:e,falling:!0}),this.shape.setOffsetX(6),this.shape.setOffsetY(12),this.shape.draw()}return wa(b,a),b}(L),c=function(){function a(){this.bonuses=[{name:"doubleJumpBonus",attribute:"jumpCount",value:1},{name:"grabbingBonus",attribute:"grab",value:2},{name:"resurectionBonus",attribute:"resurection"},{name:"speedBonus",attribute:"speed",value:.03,max:3},{name:"jumpHeightBonus",attribute:"jumpHeight",value:18,max:3},{name:"autoRezBonus",attribute:"rezBonus",value:1,max:1},{name:"tpBonus",attribute:"tpBonus",value:1,max:2},{name:"jumpBlockBonus",attribute:"jumpBlockBonus",value:1,max:1},{name:"jetpackBonus",attribute:"jetpackBonus",value:2e3,max:500}],this.playerBonuses={},this.resetBonuses()}return a.prototype.resetBonuses=function(){return this.playerBonuses={jumpHeightBonus:0,speedBonus:0,autoRezBonus:0,tpBonus:0,jumpBlockBonus:0,doubleJumpBonus:0,grabbingBonus:0,jetpackBonus:0}},a.prototype.getBonus=function(a){var b;return b=this.findBonus(a),!!this.canTake(b)&&(W.play("pickup"),this.addBonus(b),!0)},a.prototype.canTake=function(a){if(void 0===a.max)return!0;switch(a.attribute){case"speed":return this.playerBonuses.speedBonus<a.max;case"jumpHeight":return this.playerBonuses.jumpHeightBonus<a.max;case"rezBonus":return this.playerBonuses.autoRezBonus<a.max;case"tpBonus":return this.playerBonuses.tpBonus<a.max;case"jumpBlockBonus":return this.playerBonuses.jumpBlockBonus<a.max;case"jetpackBonus":return this.playerBonuses.jetpackBonus<a.max;default:return!1}},a.prototype.findBonus=function(a){var b,c,d,e;for(e=this.bonuses,c=0,d=e.length;c<d;c++)if(b=e[c],a===b.name)return b},a.prototype.addBonus=function(a){switch(a.attribute){case"speed":return ha.speed+=a.value,this.playerBonuses.speedBonus++;case"jumpHeight":return ha.addJumpHeight(a.value),this.playerBonuses.jumpHeightBonus++;case"jumpCount":return this.playerBonuses.doubleJumpBonus+=a.value;case"grab":return this.playerBonuses.grabbingBonus+=a.value;case"resurection":return ga.sendResurection(),ha.resurection();case"rezBonus":return this.playerBonuses.autoRezBonus++;case"tpBonus":return this.playerBonuses.tpBonus++;case"jumpBlockBonus":return this.playerBonuses.jumpBlockBonus++;case"jetpackBonus":return this.playerBonuses.jetpackBonus=a.value}},a.prototype.remove=function(a){var b;return b=aa.find("#"+a),b.destroy()},a.prototype.getRandomBonus=function(){var a;return a=[],R.playerBonuses.speedBonus>0&&a.push(1),R.playerBonuses.jumpHeightBonus>0&&a.push(2),R.playerBonuses.autoRezBonus>0&&a.push(6),R.playerBonuses.tpBonus>0&&a.push(7),R.playerBonuses.jumpBlockBonus>0&&a.push(8),R.playerBonuses.jetpackBonus>0&&a.push(9),a[Math.floor(Math.random()*(a.length-1))]},a}(),v=function(){function a(){this.tweens=[],this.level=0,this.levelHeight=0,this.ground=pa.getHeight()-32}return a.prototype.reset=function(){var a,b,c,d,e,f,g;for(f=this.tweens,b=0,d=f.length;b<d;b++)void 0!==(a=f[b])&&a.destroy();for(g=X.tweens,c=0,e=g.length;c<e;c++)void 0!==(a=g[c])&&a.destroy();return pa.setY(0),qa.setY(0),da.setY(0),Q.reset(),T.reset(),aa.destroyChildren(),pa.draw(),this.level=0,this.levelHeight=0,this.ground=pa.getHeight()-32},a.prototype.moveLevel=function(a){var b;return Q.add(a/32),this.levelHeight+=a,this.ground=Q.y-this.levelHeight,b=new Kinetic.Tween({node:pa,duration:2,y:pa.getY()+a,onFinish:function(){return ga.sendMoveLevelOk()}}),b.play(),this.tweens.push(b),b=new Kinetic.Tween({node:qa,duration:2,y:qa.getY()-a}),b.play(),this.tweens.push(b),b=new Kinetic.Tween({node:da,duration:2,y:da.getY()-a}),b.play(),this.tweens.push(b),b=new Kinetic.Tween({node:ra,duration:2,y:ra.y()}),b.play(),this.tweens.push(b)},a.prototype.clearLevel=function(){var a;return T.reset(),a=aa.find("Sprite"),a.each(function(a){if(a.getY()>-1*pa.getY()+pa.getHeight()||"cube"!==a.getName().type&&a.getY()>-1*pa.getY()+pa.getHeight()-32)return a.destroy()}),ha.shape.getY()>-1*pa.getY()+pa.getHeight()&&ha.kill(),Q.clearOutOfScreen(),X.convertToStatic()},a}(),j=function(){function a(){this.speed=.4,this.tweens=[]}return a.prototype.update=function(a){var b,c;return c=this,b=aa.find("Sprite"),b.each(function(b){var d,e;if(void 0!==b.getName()&&null!==b.getName()&&b.getName().falling){if(!(d=c.testMove(b,b.getY()+c.speed*a)))return b.setY(b.getY()+.1*a);if(b.setY(d.getY()-b.getHeight()),e=b.getName(),e.falling=!1,b.setName(e),void 0!==b.getId())return c.doEffect(b,b.getId())}})},a.prototype.testMove=function(a,b){var c;return a.setY(b),c=U.getCubeCollisions(a),c.length>0&&c[0]},a.prototype.convertToStatic=function(){var a;return a=aa.find("Sprite"),a.each(function(a){if("cube"===a.getName().type)return a.moveTo(ra),a.draw()})},a.prototype.convertToCube=function(a){var b;return b=a.getName(),b.type="cube",a.setName(b)},a.prototype.doEffect=function(a,b){if("iceExplosion"===b&&this.iceExplosionEffect(a),"slowblock"===b&&this.slowExplosionEffet(a),"stompblock"===b&&this.stompEffet(a),"swapblock"===b&&this.swapEffet(a),"tpblock"===b&&this.tpEffet(a),"randblock"===b)return this.doEffect(a,a.getName().randType)},a.prototype.iceExplosionEffect=function(a){return new k(a.getX(),a.getY()-2,M.EFFECT,"ice"),new k(a.getX()+32,a.getY()-2,M.EFFECT,"ice"),this.convertToCube(a)},a.prototype.slowExplosionEffet=function(a){return new k(a.getX(),a.getY()-2,M.EFFECT,"slow"),new k(a.getX()+32,a.getY()-2,M.EFFECT,"slow"),this.convertToCube(a)},a.prototype.stompEffet=function(a){return W.play("explosion"),new k(a.getX(),a.getY(),M.SMALL,"tp",null,!0),ha.jump||ha.falling||(ha.setTempJumpHeight(300),ha.jumpStart=ha.shape.getY(),ha.jumpCount=ha.jumpMax,ha.stomped=!0,ha.jump=!0,ha.forceJump=!0),this.convertToCube(a)},a.prototype.swapEffet=function(a){var b,c;return W.play("explosion"),new k(a.getX(),a.getY(),M.SMALL,"tp",null,!0),b=[],ja.find("Rect").each(function(a){var c,d;if(a._id!==ha.shape._id&&(d=ja.find("#skin-"+a.getId())[0],"dead"!==d.getAnimation()))return c=!1,"couch"!==d.getAnimation()&&"couchMove"!==d.getAnimation()||(c=!0),b.push({x:a.getX(),y:a.getY(),couched:c})}),b.length>0&&(c=Math.floor(Math.random()*b.length),ha.shape.setX(b[c].x),ha.shape.setY(b[c].y),ha.grabbing=!1,b[c].couched&&ha.startCouch(),ha.jump=!1),this.convertToCube(a)},a.prototype.tpEffet=function(a){return W.play("explosion"),new k(a.getX(),a.getY(),M.SMALL,"tp",null,!0),ha.shape.setX(a.getX()+16),ha.shape.setY(a.getY()-64),ha.jump=!1,this.convertToCube(a)},a.prototype.sendJumpBlock=function(a,b){var c;return this.tmp=new k(a+6,b,M.BONUS,"jumpBlock"),c=this.tmp.shape.getName(),c.falling=!0,this.tmp.shape.setName(c),this.tmp.shape.setOffsetX(6),this.tmp.shape.setOffsetY(12)},a.prototype.sendLootBonus=function(a,c,d){return this.tmp=new b(0,d,a+c),this.tmp.shape.setX(a+6),this.tmp.shape.setY(c)},a}(),z=function(){function a(){this.players=[],this.playersId=[]}return a.prototype.connect=function(a,b,c){return this.socket=io.connect("//"+a),this.socket.emit("login",[b,c]),this.listener()},a.prototype.listener=function(){var a;return a=this,this.socket.on("connect",function(){return document.querySelector("#login-loading").innerHTML="Connected ! Waiting for the server to join..."}),this.socket.on("join",function(){return ba.start()}),this.socket.on("fallingCube",function(a){return new l(a[0],a[1])}),this.socket.on("fallingBonus",function(a){return new b(a[0],a[1],a[2])}),this.socket.on("fallingSpecial",function(a){return new J(a[0],a[1],a[2])}),this.socket.on("fallingRandSpecial",function(a){return new J(a[0],a[1],5,a[2])}),this.socket.on("randomEvent",function(a){return new D(a)}),this.socket.on("resetLevel",function(){return fa.reset(),ha.reset()}),this.socket.on("clearLevel",function(a){return fa.clearLevel(),fa.level=a}),this.socket.on("moveLevel",function(a){return fa.moveLevel(a)}),this.socket.on("bonusTaken",function(a){return R.remove(a)}),this.socket.on("connection",function(b){return a.players[b[0]]=new O(b[0],b[1],b[2]),a.playersId.push(b[0])}),this.socket.on("disconnect",function(b){if(void 0!==a.players[b])return a.players[b].destroy()}),this.socket.on("move",function(b){if(void 0!==a.players[b[0]])return a.players[b[0]].move(b[1],b[2])}),this.socket.on("changeAnimation",function(b){if(void 0!==a.players[b[0]])return a.players[b[0]].changeAnimation(b[1])}),this.socket.on("changeAnimationSide",function(b){if(void 0!==a.players[b[0]])return a.players[b[0]].changeSide(b[1])}),this.socket.on("kill",function(b){if(void 0!==a.players[b])return a.players[b].kill()}),this.socket.on("spawnBoss",function(a){return T.spawn(a[0],a[1])}),this.socket.on("resurection",function(){return ha.resurection()}),this.socket.on("debugMap",function(a){if(V.debug)return Z(a)}),this.socket.on("playerList",function(b){var c,d,e,f,g,h;for(g=a.playersId,h=[],c=e=0,f=g.length;e<f;c=++e)d=g[c],-1===b.indexOf(d)?(void 0!==a.players[d]&&a.players[d].destroy(),h.push(a.playersId.splice(c,1))):h.push(void 0);return h}),this.socket.on("message",function(a){return ba.addMessage(a[0],a[1])}),this.socket.on("tpBonus",function(b){var c;if(void 0!==a.players[b]&&(c=a.players[b],c.shape.getY()+64<ha.shape.getY()))return ha.shape.setX(c.shape.getX()),ha.shape.setY(c.shape.getY()),ha.grabbing=!1,"couch"!==c.skin.getAnimation()&&"couchMove"!==c.skin.getAnimation()||ha.startCouch(),ha.jump=!1,new k(c.shape.getX()-24,c.shape.getY(),M.SMALL,"tp",null,!0)}),this.socket.on("sendJumpBlock",function(a){return X.sendJumpBlock(a[0],a[1])}),this.socket.on("sendLootBonus",function(a){return X.sendLootBonus(a[0],a[1],a[2])}),this.socket.on("sendDeployedJumpBonus",function(a){var b,c;return b=32*a+160,c=-1*pa.getY(),X.sendJumpBlock(b,c)})},a.prototype.sendLaunch=function(){return this.socket.emit("launch")},a.prototype.sendReset=function(){return this.socket.emit("reset")},a.prototype.sendMove=function(a,b){return this.socket.emit("move",[parseInt(a),parseInt(b)])},a.prototype.sendDie=function(){return this.socket.emit("die")},a.prototype.sendRez=function(){return this.socket.emit("rez")},a.prototype.sendMoveLevelOk=function(){return this.socket.emit("moveLevelOk")},a.prototype.sendBonusTaken=function(a){return this.socket.emit("bonusTaken",a)},a.prototype.sendAnimation=function(a){return this.socket.emit("changeAnimation",a)},a.prototype.sendAnimationSide=function(a){return this.socket.emit("changeAnimationSide",a)},a.prototype.sendBossBeaten=function(){return this.socket.emit("bossBeaten")},a.prototype.sendResurection=function(){return this.socket.emit("resurection")},a.prototype.sendMessage=function(a){return this.socket.emit("message",a)},a.prototype.sendTp=function(){return this.socket.emit("tpBonus")},a.prototype.sendJumpBlock=function(a,b){return X.sendJumpBlock(a,b),this.socket.emit("sendJumpBlock",[a,b])},a.prototype.sendLootBonus=function(a,b,c){return X.sendLootBonus(a,b,c),this.socket.emit("sendLootBonus",[a,b,c])},a}(),G=function(){function a(){this.parts=["skin","leg","head","beard","hair","body","shoes","hat"],this.skins=[],this.callback=[]}return a.prototype.createSkin=function(a,b,c){var d,e,f,g,h,i,j,k,l;for(this.callback[c]=b,g=this,d=0,e=[],null,k=this.parts,l=[],i=0,j=k.length;i<j;i++)f=k[i],h=new Image,h.src="../assets/player/"+f+"/"+a[f]+".png",e.push(h),l.push(h.onload=function(){if(++d===g.parts.length)return g.createSheet(e,c)});return l},a.prototype.createSheet=function(a,b){var c,d,e,f,g;for(d=this,f=0,g=a.length;f<g;f++)c=a[f],e=new Kinetic.Image({image:c}),sa.add(e);return sa.draw(),sa.toImage({callback:function(a){return d.callback[b](a),delete d.callback[b]}}),sa.destroyChildren(),sa.draw()},a.prototype.setSkin=function(a,b){var c;return c=document.querySelector("#skin-preview ."+a),c.style.background='url("assets/player/'+a+"/"+b+'.png") 144px 0',ma[a]=b,document.querySelector("#skin-control ."+a+" .number").innerHTML=b},a.prototype.getSkin=function(a){return document.querySelector("#skin-control ."+a+" .number").innerHTML},a.prototype.randomizeSkin=function(){var a,b,c,d,e,f,g;for(f=this.parts,g=[],d=0,e=f.length;d<e;d++)b=f[d],c=Math.floor(Math.random()*V.skins[b])+1,a=document.querySelector("#skin-preview ."+b),a.style.background='url("assets/player/'+b+"/"+c+'.png") 144px 0',ma[b]=c,g.push(document.querySelector("#skin-control ."+b+" .number").innerHTML=c);return g},a}(),F=function(){function a(){}return a.prototype.saveOptions=function(){return localStorage.setItem("player_name",document.querySelector("#name").value),localStorage.setItem("player_skin",na.getSkin("skin")),localStorage.setItem("player_hair",na.getSkin("hair")),localStorage.setItem("player_head",na.getSkin("head")),localStorage.setItem("player_body",na.getSkin("body")),localStorage.setItem("player_leg",na.getSkin("leg")),localStorage.setItem("player_shoes",na.getSkin("shoes")),localStorage.setItem("player_hat",na.getSkin("hat")),localStorage.setItem("player_beard",na.getSkin("beard")),localStorage.setItem("volume_effect",document.querySelector("#sound-effect").innerHTML),localStorage.setItem("volume_music",document.querySelector("#sound-music").innerHTML),localStorage.setItem("bg_color",document.querySelector("#color-switch a").innerHTML)},a.prototype.loadOptions=function(){return document.querySelector("#name").value=localStorage.getItem("player_name"),na.setSkin("skin",localStorage.getItem("player_skin")||1),na.setSkin("hair",localStorage.getItem("player_hair")||1),na.setSkin("head",localStorage.getItem("player_head")||1),na.setSkin("body",localStorage.getItem("player_body")||1),na.setSkin("leg",localStorage.getItem("player_leg")||1),na.setSkin("shoes",localStorage.getItem("player_shoes")||1),na.setSkin("hat",localStorage.getItem("player_hat")||1),na.setSkin("beard",localStorage.getItem("player_beard")||1),W.setEffectVolume(localStorage.getItem("volume_effect")||10),W.setMusicVolume(localStorage.getItem("volume_music")||10),W.setBG(localStorage.getItem("bg_color")||"White")},a}(),a=function(){function a(){this.y=pa.getHeight()-32,this.initHeight=32,this.height=this.initHeight,this.draw()}return a.prototype.draw=function(){var a,b,c,d,e;for(a=b=0;b<=13;a=++b)new N(32*a+128,this.y,M.SMALL);for(e=[],a=c=0,d=this.height;0<=d?c<=d:c>=d;a=0<=d?++c:--c)new N(128,this.y-32*a,M.SMALL),e.push(new N(544,this.y-32*a,M.SMALL));return e},a.prototype.reset=function(){return this.height=this.initHeight,this.clear(),this.draw()},a.prototype.clear=function(){var a;return a=ra.find("Sprite"),a.each(function(a){return a.destroy()}),ra.draw()},a.prototype.add=function(a){var b,c,d,e;for(b=c=d=this.height,e=this.height+a;d<=e?c<=e:c>=e;b=d<=e?++c:--c)new N(128,this.y-32*b,M.SMALL),new N(544,this.y-32*b,M.SMALL);return this.height+=a},a.prototype.clearOutOfScreen=function(){var a;return a=ra.find("Sprite"),a.each(function(a){if(a.getY()>-1*pa.getY()+pa.getHeight())return a.destroy()})},a}(),p=function(){function a(){this.hud={left:[{}],right:[{icon:"jumpHeightBonus"},{icon:"speedBonus"},{icon:"autoRezBonus"},{icon:"tpBonus"},{icon:"doubleJumpBonus"},{icon:"grabbingBonus"},{icon:"jumpBlockBonus"},{icon:"jetpackOffBonus"}]},this.elements={left:[],right:[]},this.drawHUD()}return a.prototype.update=function(){var a,b,c,d,e,f,g,h,i;for(b={left:[{text:"Level : "+fa.level}],right:[{text:R.playerBonuses.jumpHeightBonus+"/"+R.bonuses[4].max},{text:R.playerBonuses.speedBonus+"/"+R.bonuses[3].max},{text:R.playerBonuses.autoRezBonus+"/"+R.bonuses[5].max},{text:R.playerBonuses.tpBonus+"/"+R.bonuses[6].max+" (T)"},{text:R.playerBonuses.doubleJumpBonus},{text:R.playerBonuses.grabbingBonus},{text:R.playerBonuses.jumpBlockBonus+"/"+R.bonuses[7].max+" (Y)"},{text:R.playerBonuses.jetpackBonus+" (G)"+ha.getJetpackText()}]},h=b.left,c=d=0,f=h.length;d<f;c=++d)a=h[c],this.elements.left[c].setText(a.text);for(i=b.right,c=e=0,g=i.length;e<g;c=++e)a=i[c],this.elements.right[c].setText(a.text);return da.draw()},a.prototype.drawHUD=function(){var a,b,c,d,e,f,g,h,i,j,k;for(i=this.hud.left,b=e=0,g=i.length;e<g;b=++e)a=i[b],d=new Kinetic.Text({y:Q.y-32*this.elements.left.length,fill:"black",fontFamily:"Calibri",fontSize:18}),da.add(d),this.elements.left[b]=d;for(j=this.hud.right,k=[],b=f=0,h=j.length;f<h;b=++f)a=j[b],void 0!==a.icon?(c=new L(pa.getWidth()-124,Q.y-36*this.elements.right.length,M.SMALL,"bonus",a.icon),c=c.shape,da.add(c),d=new Kinetic.Text({y:Q.y-36*this.elements.right.length+10,x:pa.getWidth()-90,fill:"black",fontFamily:"Calibri",fontSize:18}),da.add(d),k.push(this.elements.right[b]=d)):(d=new Kinetic.Text({y:Q.y-36*this.elements.right.length,x:pa.getWidth()-96,fill:"black",fontFamily:"Calibri",fontSize:18}),da.add(d),k.push(this.elements.right[b]=d));return k},a}(),k=function(a){function b(a,c,d,e,f,g){var h,i,j,k;void 0!==g?(b.__super__.constructor.call(this,a,c,d,"bonus",e),aa.add(this.shape),this.shape.setName({type:"effect",name:e}),this.shape.draw(),this.shape.setX(this.shape.getX()+16),this.shape.setY(this.shape.getY()+16),j=this.shape,k=new Kinetic.Tween({node:this.shape,duration:.3,scaleX:2,scaleY:2,x:a,y:c,onFinish:function(){return j.destroy()}}),k.play(),X.tweens.push(k)):(b.__super__.constructor.call(this,a,c,d,"effects",e),aa.add(this.shape),this.shape.setName({type:"effect",name:e}),this.shape.draw(),"explosionEffect"===e||"iceExplosionEffect"===e||"smallExplosionEffect"===e?this.shape.setFrameRate(20):"blood"!==e&&"bioExplosion"!==e||this.shape.setFrameRate(16),this.shape.start(),void 0!==f&&(i=this,h=this.shape.getAnimations()[this.shape.getAnimation()].length/4-1,this.shape.on("frameIndexChange",function(){if(i.shape.frameIndex()===h)return i.shape.destroy()})))}return wa(b,a),b}(L),A=function(a){function b(){b.__super__.constructor.call(this,-32,this.getY(),M.SMALL,"pidgeon","fly"),qa.add(this.shape),this.shape.setFrameRate(8),this.shape.start(),this.speed=.05,this.side=1}return wa(b,a),b.prototype.update=function(a){var b,c;return b=this.speed*a,c=this.shape.getX()+b*this.side,(c>1e3||c<-256)&&(this.side*=-1,this.shape.setScaleX(this.side),this.shape.setY(this.getY())),this.shape.setX(c)},b.prototype.getY=function(){return Q.y-32*Math.floor(12*Math.random()+12)},b}(L),d=function(a){function b(a,c,d,e,f){this.origin={x:c,y:d},this.speed=.2,b.__super__.constructor.call(this,c,d,{x:e,y:f},"boss",a),aa.add(this.shape),this.shape.setName({type:"boss",name:a}),this.shape.setFrameRate(10),this.shape.start()}return wa(b,a),b.prototype.finish=function(){return T.stopUpdate(),this.shape.destroy(),ga.sendBossBeaten()},b.prototype.reset=function(){return this.shape.destroy()},b.prototype.move=function(a,b,c){var d,e;return d=this.speed*a,this.origin.x>b?(e=this.shape.getX()-d,e>b?this.shape.setX(e):(this.shape.setX(b),this.origin.x=b)):this.origin.x<b&&(e=this.shape.getX()+d,e<b?this.shape.setX(e):(this.shape.setX(b),this.origin.x=b)),this.origin.y>c?(e=this.shape.getY()-d,e>c?this.shape.setY(e):(this.shape.setY(c),this.origin.y=c)):this.origin.y<c&&(e=this.shape.getY()+d,e<c?this.shape.setY(e):(this.shape.setY(c),this.origin.y=c)),this.shape.getX()===b&&this.shape.getY()===c},b.prototype.vectorMove=function(a,b,c,d,e,f,g){var h,i,j;return i=this.shape.getX()+b,j=this.shape.getY()+c,h={mX:!1,mY:!1,pX:!1,pY:!1},i<=d?(this.shape.setX(d),h.mX=!0):this.shape.setX(i),j<=f?(this.shape.setY(f),h.mY=!0):this.shape.setY(j),i>=e?(this.shape.setX(e),h.pX=!0):this.shape.setX(i),j>=g?(this.shape.setY(g),h.pY=!0):this.shape.setY(j),h},b}(L),y=function(a){function b(a,c,d,e,f){b.__super__.constructor.call(this,a,c,d,e,f),this.parts=[]}return wa(b,a),b.prototype.reset=function(){var a,c,d,e,f;for(b.__super__.reset.call(this),e=this.parts,f=[],c=0,d=e.length;c<d;c++)a=e[c],f.push(a.reset());return f},b.prototype.finish=function(){return this.reset(),T.stopUpdate(),ga.sendBossBeaten()},b}(d),e=function(){function a(){this.currentBoss}return a.prototype.spawn=function(a,b){if(1===a&&(this.currentBoss=new E(b)),2===a&&(this.currentBoss=new m(b)),3===a&&(this.currentBoss=new C(b)),4===a&&(this.currentBoss=new t(b)),5===a&&(this.currentBoss=new H(b)),6===a&&(this.currentBoss=new q(b)),7===a)return this.currentBoss=new w(b)},a.prototype.reset=function(){if(this.stopUpdate(),void 0!==this.currentBoss)return this.currentBoss.reset()},a.prototype.update=function(a){},a.prototype.stopUpdate=function(){return this.update=function(a){}},a}(),E=function(a){function b(a){var c,d;c=pa.getWidth()/2-32,d=fa.ground-1024,b.__super__.constructor.call(this,"roueman",c,d,64,64),this.attacks=a[1],this.attackIndex=0,this.speed=a[0],this.start()}return wa(b,a),b.prototype.start=function(){var a;return this.next(),a=this,T.update=function(b){if(a.move(b,a.attack.x,a.attack.y))return a.next()}},b.prototype.next=function(){var a;return a=this.attacks[this.attackIndex],void 0!==a?(this.attack={x:this.shape.getX()+32*a[0],y:this.shape.getY()+32*a[1]},this.attackIndex++):this.finish()},b}(d),m=function(){function a(a){this.speed=a[0][0],this.counter=0,this.interval=a[0][1],this.attacks=a[1],this.attackIndex=0,this.count=0,this.parts=[],this.start(),this.next()}return a.prototype.start=function(){var a,b,c;for(a=c=5;c<=16;a=++c)new k(32*a,fa.ground-4,M.SMALL,"ice");return b=this,T.update=function(c){var d,e,f,g,h,i;for(b.counter+=c,b.counter>=b.interval&&(b.counter=0,b.next()),e=c*b.speed,i=b.parts,a=g=0,h=i.length;g<h;a=++g)void 0!==(d=i[a])&&(f=d.shape.getY()+e,f<fa.ground?d.shape.setY(f):(d.shape.destroy(),b.parts[a]=null,++b.count===2*b.attacks.length&&b.finish()));return b.parts=b.parts.filter(function(a){return a})}},a.prototype.next=function(){var a;if(void 0!==(a=this.attacks[this.attackIndex]))return this.parts.push(new n(32*a[0]+128)),this.parts.push(new n(32*a[1]+128)),this.attackIndex++},a.prototype.reset=function(){var a,b,c,d,e;for(d=this.parts,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push(a.reset());return e},a.prototype.finish=function(){return T.stopUpdate(),ga.sendBossBeaten()},a}(),n=function(a){function b(a){var c;c=-1*pa.getY(),b.__super__.constructor.call(this,"freezeman",a,c,544,32)}return wa(b,a),b}(d),C=function(a){function b(a){var c;c=900,this.levelHeight=Q.y-fa.levelHeight,this.y=this.levelHeight-256,b.__super__.constructor.call(this,"poingman",c,this.y,64,64),this.attacking=!1,this.comeBack=!1,this.finishing=!1,this.starting=!0,this.waiting=!1,this.time=0,this.speed=a[0][0],this.attackSpeed=a[0][1],this.waitTime=a[0][2],this.attacks=a[1],this.originSpeed=this.speed,this.index=0,this.start()}return wa(b,a),b.prototype.start=function(){var a;return this.destroyGround(),this.regenMap(),a=this,T.update=function(b){if(!a.attacking||a.finishing||a.starting||a.waiting){if(a.finishing||a.starting||a.waiting){if(a.starting||a.waiting){if(a.waiting)return a.wait(b);if(a.move(b,0,a.shape.getY()))return a.starting=!1}else if(a.move(b,800,a.shape.getY()))return a.finish()}else if(a.move(b,32*a.attacks[a.index]+160,a.shape.getY()))return a.attacking=!0,a.waiting=!0,a.speed=a.attackSpeed}else{if(!a.comeBack&&a.move(b,a.shape.getX(),a.levelHeight-62))return a.destroyBlocks();if(a.move(b,a.shape.getX(),a.y))return a.finishAttack()}}},b.prototype.finishAttack=function(){if(this.index++,this.attacking=!1,this.comeBack=!1,this.speed=this.originSpeed,void 0===this.attacks[this.index])return this.finishing=!0,this.regenMap()},b.prototype.destroyBlocks=function(){var a,b,c,d,e,f,g,h;for(W.play("explosion"),this.comeBack=!0,b=U.getStaticCollisions(this.shape),e=0,g=b.length;e<g;e++){if(a=b[e],void 0===a.getName()||!0!==a.getName().broken)for(d=f=0,h=a.getWidth()/32-1;0<=h?f<=h:f>=h;d=0<=h?++f:--f)c=new L(a.getX()+32*d,a.getY(),M.SMALL,"cubes","brokenCube"),c.shape.setName({type:"cube",broken:!0}),ra.add(c.shape);a.destroy()}return ra.draw()},b.prototype.destroyGround=function(){var a;return a=aa.find("Sprite"),a.each(function(a){if("boss"!==a.getName().type)return a.destroy()}),a=ra.find("Sprite"),a.each(function(a){if(a.getX()>128&&a.getX()<544)return a.destroy()})},b.prototype.regenMap=function(){var a,b,c;for(c=[],a=b=1;b<=12;a=++b)c.push(new N(32*a+128,this.levelHeight,M.SMALL));return c},b.prototype.wait=function(a){if(this.time+=a,this.time>=this.waitTime)return this.time=0,this.waiting=!1},b}(d),t=function(a){function b(a){var c,d;c=256,d=-1*pa.getY(),this.oldPos={x:c,y:d},b.__super__.constructor.call(this,"labiman",c,d,64,64),this.attacks=a[1],this.speed=a[0][0],this.attackSpeed=a[0][1],this.wait=a[0][2],this.maxHeight=this.getMaxHeight(),this.waiting=!1,this.attacking=!1,this.index=0,this.waitTime=0,this.start()}return wa(b,a),b.prototype.getMaxHeight=function(){var a,b,c,d,e;for(b=0,e=this.attacks,c=0,d=e.length;c<d;c++)a=e[c],a[1]>b&&(b=a[1]);return b},b.prototype.start=function(){var a;return a=this,this.parts.push(new u),T.update=function(b){if(a.waiting?a.bossEscape(b):a.move(b,32*a.attacks[a.index][0]+160,fa.ground-32*a.attacks[a.index][1])&&(a.index++,a.placeBlock(),void 0===a.attacks[a.index]&&(a.waiting=!0)),a.attacking&&a.attack(b),a.waitTime+=b,!a.attacking&&a.waitTime>=a.wait)return a.attacking=!0}},b.prototype.attack=function(a){var b,c;return c=this.parts[0].shape.getY()-this.attackSpeed*a,b=fa.ground-32*this.maxHeight+8,c>b?this.parts[0].shape.setY(c):(this.parts[0].shape.setY(b),this.finish())},b.prototype.placeBlock=function(){return new i(this.shape.getX(),this.shape.getY(),M.SMALL)},b.prototype.bossEscape=function(a){var b;if((b=this.shape.getX()+this.speed*a)<800)return this.shape.setX(b)},b.prototype.finish=function(){return b.__super__.finish.call(this),aa.find("Sprite").each(function(a){return a.destroy()})},b}(y),u=function(a){function b(){var a;a=Q.y-fa.levelHeight+32,b.__super__.constructor.call(this,"freezeman",80,a,544,32)}return wa(b,a),b}(d),H=function(a){function b(a){var c,d;c=pa.getWidth()/2-32,d=-1*pa.getY()-64,b.__super__.constructor.call(this,"sparkman",c,d,64,64),this.speed=a[0][0],this.attackSpeed=a[0][1],this.interval=a[0][2],this.attacks=a[1],this.position=fa.ground-512,this.time=0,this.attackCount=0,this.attackFinished=0,this.attackIndex=0,this.inPosition=!1,this.start()}return wa(b,a),b.prototype.start=function(){var a;return a=this,T.update=function(b){return a.inPosition?a.time>=a.interval?(a.time=0,a.attack()):a.attackCount<a.attacks.length&&(a.time+=b):a.move(b,a.shape.getX(),a.position)&&(a.inPosition=!0,a.time=.75*a.interval),a.updateParts(b)}},b.prototype.attack=function(){return this.parts.push(new I(this.shape.getX()+16,this.shape.getY()+64,this.attacks[this.attackIndex])),this.parts.push(new I(this.shape.getX()+16,this.shape.getY()+64,this.attacks[this.attackIndex+1])),this.attackCount+=2,this.attackIndex+=2},b.prototype.updateParts=function(a){var b,c,d,e,f,g,h;for(h=this.parts,f=0,g=h.length;f<g;f++)c=h[f],d=this.attackSpeed*a*c.sideX,e=c.ySpeed*a*c.sideY,b=c.vectorMove(a,d,e,160,pa.getWidth()-192,this.position-96,fa.ground-32),b.mX&&(c.sideX=1),b.pX&&(c.sideX=-1),b.mY&&(c.sideY=1),b.pY&&(c.sideY=-1),c.alive&&(c.life+=a,c.life>2*this.interval&&c.reset());if(this.attackFinished===this.attacks.length)return this.quitScreen(a)},b.prototype.quitScreen=function(a){if(this.move(a,800,this.shape.getY()))return this.finish()},b}(y),I=function(a){function b(a,c,d){b.__super__.constructor.call(this,"spark",a,c,32,32),this.sideX=d[0],this.sideY=d[1],this.ySpeed=d[2],this.life=0,this.alive=!0}return wa(b,a),b.prototype.reset=function(){return b.__super__.reset.call(this),T.currentBoss.attackFinished++,this.alive=!1},b}(d),q=function(a){function b(a){var c,d;c=pa.getWidth()/2-32,d=-1*pa.getY()-64,b.__super__.constructor.call(this,"homingman",c,d,64,64),this.speed=a[0][0],this.attackSpeed=a[0][1],this.attacks=a[1],this.inPosition=0,this.attackCount=1,this.position=fa.ground-384,this.start()}return wa(b,a),b.prototype.start=function(){var a;return a=this,T.update=function(b){if(a.move(b,a.shape.getX(),a.position))return a.attack(),a.speed=a.attackSpeed,T.update=function(b){return a.updateParts(b)}}},b.prototype.attack=function(){var a,b,c,d,e;for(d=this.attacks,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push(this.parts.push(new r(this.shape.getX()+16,this.shape.getY()+64,a)));return e},b.prototype.updateParts=function(a){var b,c,d,e,f,g,h,i,j;for(h=this.parts,d=0,f=h.length;d<f;d++)b=h[d],void 0!==b.pattern[b.index]&&(c={x:352*parseInt(b.pattern[b.index][0])+160},0===b.index?c.y=fa.ground-32*parseInt(b.pattern[0][1]):c.y=b.shape.getY(),b.ready&&!b.position&&b.move(a,c.x,c.y)&&(this.inPosition++,b.position=!0,b.index++));if(6===this.inPosition){if(this.attackCount===this.attacks[0].length)return this.quitScreen(a);for(this.inPosition=0,this.attackCount++,i=this.parts,j=[],e=0,g=i.length;e<g;e++)b=i[e],b.position=!1,b.ready=!1,j.push(b.wait());return j}},b.prototype.quitScreen=function(a){var b,c,d,e;for(e=this.parts,c=0,d=e.length;c<d;c++)b=e[c],b.move(a,b.shape.getX(),b.shape.getY()+100);if(this.move(a,800,this.shape.getY()))return this.finish()},b}(y),r=function(a){function b(a,c,d){b.__super__.constructor.call(this,"phantom",a,c,32,32),this.pattern=d,this.index=0,this.position=!1,this.ready=!0}return wa(b,a),b.prototype.wait=function(){var a,b;if(void 0!==this.pattern[this.index])return b=this,a=function(){return b.ready=!0},setTimeout(a,this.pattern[this.index][1])},b}(d),w=function(a){function b(a){b.__super__.constructor.call(this,"missileman",-512,0,0,0),this.speed=a[0][0],this.interval=a[0][1],this.attacks=a[1],this.time=0,this.attackCount=0,this.attackFinished=0,this.attackIndex=0,this.start()}return wa(b,a),b.prototype.start=function(){var a;return a=this,T.update=function(b){return a.time>=a.interval?(a.time=0,a.attack()):a.attackCount<a.attacks.length&&(a.time+=b),a.updateParts(b)}},b.prototype.attack=function(){return this.parts.push(new x(this.attacks[this.attackIndex][0],fa.ground,this.attacks[this.attackIndex][1])),this.attackCount++,this.attackIndex++},b.prototype.updateParts=function(a){var b,c,d,e,f,g;for(g=this.parts,e=0,f=g.length;e<f;e++)b=g[e],d=a*this.speed,b.launching?(b.shape.setY(b.shape.getY()-d),b.effect.shape.setY(b.effect.shape.getY()-d),c=fa.ground-1024,b.shape.getY()<c&&(b.launching=!1,b.shape.setY(c),b.changeSide(-1),b.shape.setX(b.destination),b.effect.shape.setX(b.destination))):(b.shape.setY(b.shape.getY()+d),b.effect.shape.setY(b.effect.shape.getY()+d),b.shape.getY()>=fa.ground&&b.reset());if(this.attackFinished===this.attacks.length)return this.finish()},b}(y),x=function(a){function b(a,c,d){var e;b.__super__.constructor.call(this,"missileman",a,c,32,32),this.launching=!0,this.alive=!0,e=1,this.effect=new k(a,c,M.SMALL,"missileEffect"),this.destination=d,this.changeSide(e)}return wa(b,a),b.prototype.changeSide=function(a){return 1===a?(this.effect.shape.setScaleY(-1),this.effect.shape.setY(this.shape.getY()+95)):(this.shape.setScaleY(-1),this.effect.shape.setScaleY(1),this.effect.shape.setY(this.shape.getY()-95))},b.prototype.reset=function(){var a,c,d;if(this.alive&&(b.__super__.reset.call(this),this.effect.shape.destroy(),this.alive=!1,T.currentBoss.attackFinished++,W.play("explosion"),a=new k(this.shape.getX()-16,this.shape.getY()-64,M.MEDIUM,"smallExplosionEffect",!0),d=U.getBoundBox(ha.shape),c=U.getBoundBox(a.shape),U.colliding(d,c)))return ha.kill()},b}(d),pa=new Kinetic.Stage({container:"container",width:V.levelWidth,height:V.levelHeight}),aa=new Kinetic.Layer({hitGraphEnabled:!1}),ja=new Kinetic.Layer({hitGraphEnabled:!1}),ra=new Kinetic.Layer({hitGraphEnabled:!1}),qa=new Kinetic.Layer({hitGraphEnabled:!1}),da=new Kinetic.FastLayer({hitGraphEnabled:!1}),sa=new Kinetic.FastLayer({hitGraphEnabled:!1}),pa.add(qa),pa.add(ja),pa.add(ra),pa.add(aa),pa.add(da),pa.add(sa),ga=new z,W=new g,U=new f,ea=new s,fa=new v,R=new c,T=new e,X=new j,na=new G,la=new F,ba=new o,ba.loadAssets(),Q=null,ha=null,ca=null,ma={body:1,hair:1,head:1,leg:1,shoes:1,skin:1,hat:1,beard:1},V.debug&&(Y=new Kinetic.Layer,pa.add(Y),Y.setZIndex(100),Z=function(a){var b,c,d,e,f,g,h,i;for(Y.destroyChildren(),d=f=0,h=a.length;f<h;d=++f)for(c=a[d],e=g=0,i=c.length;g<i;e=++g)null!==c[e]&&(b=new Kinetic.Rect({x:32*d+160,y:fa.ground-32*e-32,width:32,height:32,stroke:"red"}),Y.add(b));return Y.draw()}),W.contentsLoaded=function(){var b;return document.querySelector("#login-form").style.display="block",document.querySelector("#login-loading").style.display="none",la.loadOptions(),W.playSong(),b=function(b){var c,d;return c=new Kinetic.Image({width:pa.getWidth(),height:pa.getHeight(),image:W.images.bg}),qa.add(c),c.setZIndex(-1),c.draw(),Q=new a,ha=new h(ma),ca=new p,ga.connect(V.host,b,ma),d=new A,ba.update=function(a){return ba.draw(),ha.update(a),T.update(a),ca.update(a),X.update(a),d.update(a)},ba.draw=function(){return ja.drawScene(),aa.drawScene()}},document.querySelector("#play").onclick=function(){var a;return a=document.querySelector("#name").value,a?(document.querySelector("#login-form").style.display="none",document.querySelector("#login-loading").style.display="block",document.querySelector("#login-loading").innerHTML="Connecting...",b(a),W.play("beep"),la.saveOptions()):alert("Name required")}},window.onresize=function(){return ba.resize()},document.querySelector("#sound-mute-effect").onclick=function(){return"muted"===this.className?(this.className="un-muted",W.unmuteEffect()):(this.className="muted",W.muteEffect())},document.querySelector("#sound-mute-music").onclick=function(){return"muted"===this.className?(this.className="un-muted",W.unmuteMusic()):(this.className="muted",W.muteMusic())},document.querySelector("#sound-add-effect").onclick=function(){return W.addVolumeEffect()},document.querySelector("#sound-add-music").onclick=function(){return W.addVolumeMusic()},document.querySelector("#sound-sub-effect").onclick=function(){return W.lessVolumeEffect()},document.querySelector("#sound-sub-music").onclick=function(){return W.lessVolumeMusic()},document.querySelector("#music-prev").onclick=function(){return W.prevSong()},document.querySelector("#music-next").onclick=function(){return W.nextSong()},document.querySelector("#color-switch").onclick=function(){return W.changeBG()},document.querySelector("#randomize").onclick=function(){return na.randomizeSkin()},_=document.querySelectorAll("#skin-control div a"),ta=0,ua=_.length;ta<ua;ta++)$=_[ta],$.onclick=function(a){var b,c,d;return W.play("beep"),a.preventDefault(),b=document.querySelector("#skin-preview ."+this.getAttribute("data-type")),d=b.style.background.split("/"),c=parseInt(d[d.length-1].split(".png")[0])+parseInt(this.getAttribute("data-add")),c<1?c=V.skins[this.getAttribute("data-type")]:c>V.skins[this.getAttribute("data-type")]&&(c=1),b.style.background='url("assets/player/'+this.getAttribute("data-type")+"/"+c+'.png") 144px 0',ma[this.getAttribute("data-type")]=c,document.querySelector("#skin-control ."+this.getAttribute("data-type")+" .number").innerHTML=c}}).call(this);