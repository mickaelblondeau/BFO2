(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb={}.hasOwnProperty,hb=function(a,b){function c(){this.constructor=a}for(var d in b)gb.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};for(N={levelHeight:976,levelWidth:704,levelSpeed:1e3,playerJumpMax:1,playerJumpHeight:82,playerSpeed:.17,debug:!0,skins:{body:3,hair:3,head:1,leg:3,shoes:3,skin:3}},r=function(){function a(){this.defineEvents(),this.keys={left:!1,right:!1,up:!1,down:!1}}return a.prototype.defineEvents=function(){var a;return a=[{keys:"left",on_keydown:function(a){return a.preventDefault(),W.keys.left=!0},on_release:function(){return W.keys.left=!1}},{keys:"right",on_keydown:function(a){return a.preventDefault(),W.keys.right=!0},on_release:function(){return W.keys.right=!1}},{keys:"down",on_keydown:function(a){return a.preventDefault(),W.keys.down=!0},on_release:function(){return W.keys.down=!1}},{keys:"up",on_keydown:function(a){return a.preventDefault(),W.keys.up=!0},on_release:function(){return W.keys.up=!1}},{keys:"r",on_keydown:function(){return T.writting?void 0:T.reset()}},{keys:"e",on_keydown:function(){return T.writting?void 0:T.launch()}},{keys:"enter",on_keydown:function(){return T.chat()}}],keypress.register_many(a)},a}(),G=requestAnimationFrame||webkitRequestAnimationFrame||mozRequestAnimationFrame||oRequestAnimationFrame||msRequestAnimationFrame||null,p=function(){function a(){this.statsInit(),this.writting=!1}return a.prototype.loop=function(){var b,c;return c=Date.now(),b=c-this.lastFrame,G(a.prototype.loop.bind(this)),this.lastFrame=c,b>200&&(b=200),T.statsBegin(),T.update(b),T.statsEnd()},a.prototype.update=function(){},a.prototype.start=function(){return this.lastFrame=Date.now(),this.resize(),this.loop()},a.prototype.resize=function(){return document.getElementById("container").style.margin="-"+(N.levelHeight-window.innerHeight)+" auto",document.getElementById("container").style.width=N.levelWidth},a.prototype.statsInit=function(){return this.fps=new Stats,document.body.appendChild(this.fps.domElement)},a.prototype.statsBegin=function(){return this.fps.begin()},a.prototype.statsEnd=function(){return this.fps.end()},a.prototype.reset=function(){return void 0!==Y.socket?Y.sendReset():void 0},a.prototype.launch=function(){return void 0!==Y.socket?Y.sendLaunch():void 0},a.prototype.loadAssets=function(){return O.loadImage({name:"cubes",url:"../assets/cubes.jpg"}),O.loadImage({name:"cubes_red",url:"../assets/cubes_red.jpg"}),O.loadImage({name:"cubes_blue",url:"../assets/cubes_blue.jpg"}),O.loadImage({name:"cubes_green",url:"../assets/cubes_green.jpg"}),O.loadImage({name:"cubes_special",url:"../assets/cubes_special.jpg"}),O.loadImage({name:"effects",url:"../assets/effects.png"}),O.loadImage({name:"bonus",url:"../assets/bonus.png"}),O.loadImage({name:"bg",url:"../assets/bg.jpg"}),O.loadImage({name:"boss",url:"../assets/boss.png"}),O.loadImage({name:"playerSpirteSheet",url:"../assets/playerSpirteSheet.png"}),O.loadSound({name:"beep",url:"../assets/sounds/beep.wav",type:"effect"}),O.loadSound({name:"death",url:"../assets/sounds/death.wav",type:"effect"}),O.loadSound({name:"explosion",url:"../assets/sounds/explosion.wav",type:"effect"}),O.loadSound({name:"pickup",url:"../assets/sounds/pickup.wav",type:"effect"}),O.loadSound({name:"music1",url:"../assets/sounds/music/music.ogg",type:"music"}),O.loadSound({name:"music2",url:"../assets/sounds/music/music2.ogg",type:"music"}),O.loadSound({name:"music3",url:"../assets/sounds/music/music3.ogg",type:"music"}),O.load()},a.prototype.chat=function(){return"chatMessage"===document.activeElement.id?(this.writting=!1,void 0!==document.activeElement.value&&""!==document.activeElement.value.trim()&&(Y.sendMessage(document.getElementById("chatMessage").value),this.addMessage("Me",document.getElementById("chatMessage").value)),document.getElementById("chatMessage").blur(),document.getElementById("chatMessage").value=null):(this.writting=!0,document.getElementById("chatMessage").focus())},a.prototype.addMessage=function(a,b){var c;return O.play("beep"),document.getElementById("chatMessages").innerHTML+='<div class="message"><span class="from">'+a+'</span> : <span class="content">'+b+"</span></div>",c=function(){return document.querySelectorAll("#chatMessages .message")[0].remove()},setTimeout(c,3e3)},a}(),g=function(){function a(){this.imagesToLoad=[],this.soundsToLoad=[],this.images=[],this.sounds=[],this.count=0,this.total=0,this.musics=0,this.currentSong}return a.prototype.loadImage=function(a){return this.imagesToLoad.push(a)},a.prototype.loadSound=function(a){return this.soundsToLoad.push(a)},a.prototype.load=function(){var a,b,c,d,e,f,g,h,i,j,k,l;for(d=this,this.total=this.imagesToLoad.length+this.soundsToLoad.length,j=this.imagesToLoad,f=0,h=j.length;h>f;f++)c=j[f],b=new Image,b.src=c.url,this.images[c.name]=b,b.onload=function(){return d.count++,d.count===d.total?d.contentsLoaded():void 0};for(k=this.soundsToLoad,l=[],g=0,i=k.length;i>g;g++)e=k[g],a=new Audio,a.src=e.url,a.volume=.1,this.sounds[e.name]=a,a.oncanplaythrough=function(){return d.count++,d.count===d.total?d.contentsLoaded():void 0},"music"===e.type?(this.musics++,l.push(a.addEventListener("ended",function(){return d.nextSong()}))):l.push(void 0);return l},a.prototype.contentsLoaded=function(){},a.prototype.muteEffect=function(){var a,b,c,d;for(d=this.soundsToLoad,b=0,c=d.length;c>b;b++)a=d[b],"effect"===a.type&&(this.sounds[a.name].volume=0);return document.querySelector("#sound-effect").innerHTML=0},a.prototype.muteMusic=function(){var a,b,c,d;for(d=this.soundsToLoad,b=0,c=d.length;c>b;b++)a=d[b],"music"===a.type&&(this.sounds[a.name].volume=0);return document.querySelector("#sound-music").innerHTML=0},a.prototype.addVolumeEffect=function(){var a,b,c,d,e,f;for(e=this.soundsToLoad,f=[],c=0,d=e.length;d>c;c++)a=e[c],"effect"===a.type&&(b=this.sounds[a.name].volume+.05,1>=b?this.sounds[a.name].volume=b:(b=1,this.sounds[a.name].volume=b)),document.querySelector("#sound-effect").innerHTML=Math.floor(100*b),f.push(document.querySelector("#sound-mute-effect").className="un-muted");return f},a.prototype.addVolumeMusic=function(){var a,b,c,d,e;for(e=this.soundsToLoad,c=0,d=e.length;d>c;c++)a=e[c],"music"===a.type&&(b=this.sounds[a.name].volume+.05,1>=b?this.sounds[a.name].volume=b:(b=1,this.sounds[a.name].volume=b));return document.querySelector("#sound-music").innerHTML=Math.floor(100*b),document.querySelector("#sound-mute-music").className="un-muted"},a.prototype.lessVolumeEffect=function(){var a,b,c,d,e,f;for(e=this.soundsToLoad,f=[],c=0,d=e.length;d>c;c++)a=e[c],"effect"===a.type&&(b=this.sounds[a.name].volume-.05,b>=0?this.sounds[a.name].volume=b:(b=0,this.sounds[a.name].volume=b,document.querySelector("#sound-mute-effect").className="muted")),f.push(document.querySelector("#sound-effect").innerHTML=Math.floor(100*b));return f},a.prototype.lessVolumeMusic=function(){var a,b,c,d,e;for(e=this.soundsToLoad,c=0,d=e.length;d>c;c++)a=e[c],"music"===a.type&&(b=this.sounds[a.name].volume-.05,b>=0?this.sounds[a.name].volume=b:(b=0,this.sounds[a.name].volume=b,document.querySelector("#sound-mute-music").className="muted"));return document.querySelector("#sound-music").innerHTML=Math.floor(100*b)},a.prototype.play=function(a){return this.sounds[a].pause(),this.sounds[a].currentTime=0,this.sounds[a].play()},a.prototype.playSong=function(){var a;return a=Math.floor(Math.random()*this.musics+1),this.currentSong=a,this.sounds["music"+a].play()},a.prototype.nextSong=function(){return this.currentSong++,void 0!==this.sounds["music"+this.currentSong]?this.sounds["music"+this.currentSong].play():(this.sounds.music1.play(),this.currentSong=1)},a}(),f=function(){function a(){}return a.prototype.getBoundBox=function(a){return{top:a.getY(),bottom:a.getY()+a.getHeight(),left:a.getX(),right:a.getX()+a.getWidth()}},a.prototype.colliding=function(a,b){return!(a.left>=b.right||a.right<=b.left||a.top>=b.bottom||a.bottom<=b.top)},a.prototype.collidingCorners=function(a,b){return(b.right>=a.left&&b.right<a.right&&b.top>=a.top&&b.top<a.bottom||b.left>=a.left&&b.left<a.right&&b.top>=a.top&&b.top<a.bottom)&&a.top>b.top-5},a}(),x=function(){function a(a){var b,c;this.heightCouched=30,this.height=46,this.active=!1,this.playerSkin=a,this.draw(),this.spawn(),c=this,b=function(a){return c.skin.setImage(a),c.fixSkinPos()},ab.createSkin(a,b,c.skin._id)}return a.prototype.draw=function(){var a;return this.shape=new Kinetic.Rect({width:22,height:this.height,stroke:null}),$.add(this.shape),a={idle:[{x:288,y:0,width:48,height:48}],jump:[{x:336,y:0,width:48,height:48}],fall:[{x:384,y:0,width:48,height:48}],run:[{x:0,y:0,width:48,height:48},{x:48,y:0,width:48,height:48},{x:96,y:0,width:48,height:48},{x:144,y:0,width:48,height:48},{x:192,y:0,width:48,height:48},{x:240,y:0,width:48,height:48}],couch:[{x:0,y:48,width:48,height:48}],couchMove:[{x:48,y:48,width:48,height:48},{x:96,y:48,width:48,height:48},{x:144,y:48,width:48,height:48},{x:192,y:48,width:48,height:48},{x:240,y:48,width:48,height:48}],grabbing:[{x:0,y:96,width:48,height:48}],dead:[{x:288,y:48,width:48,height:48}]},this.animationsIndex=[{id:1,name:"idle"},{id:2,name:"jump"},{id:3,name:"fall"},{id:4,name:"run"},{id:5,name:"couch"},{id:6,name:"couchMove"},{id:7,name:"grabbing"},{id:8,name:"dead"}],this.skin=new Kinetic.Sprite({image:O.images.playerSpirteSheet,animation:"run",animations:a,frameRate:7,index:0}),$.add(this.skin),this.skin.start()},a.prototype.spawn=function(){return this.shape.setX(336),this.shape.setY(-1*bb.getY())},a.prototype.reset=function(){return this.spawn(),this.alive=!0,this.falling=!0,this.jumpMax=N.playerJumpMax,this.speed=N.playerSpeed,this.jumpHeight=N.playerJumpHeight,this.grabbing=!1,this.canGrab=!1,this.coopJump=!1},a.prototype.resurection=function(){return this.alive?void 0:this.reset()},a.prototype.fixSkinPos=function(){return this.skin.setX(-1===this.skin.getScaleX()?this.shape.getX()-12+48:this.shape.getX()-12),this.skin.setY("couch"===this.skin.getAnimation()||"couchMove"===this.skin.getAnimation()?this.shape.getY()-18:this.shape.getY())},a.prototype.changeAnimation=function(a){var b;return b=this.getAnimationByIndex(a),this.skin.getAnimation()!==b?(this.skin.setAnimation(b),this.fixSkinPos()):void 0},a.prototype.changeSide=function(a){return-1===a?(this.skin.setScaleX(-1),this.skin.setX(this.skin.getX()+48)):1===a?(this.skin.setScaleX(1),this.skin.setX(this.skin.getX()-48)):void 0},a.prototype.getAnimationByIndex=function(a){var b,c,d,e;for(e=this.animationsIndex,c=0,d=e.length;d>c;c++)if(b=e[c],b.id===a)return b.name},a.prototype.getIndexByAnimation=function(a){var b,c,d,e;for(e=this.animationsIndex,c=0,d=e.length;d>c;c++)if(b=e[c],b.name===a)return b.id},a}(),h=function(a){function b(a){b.__super__.constructor.call(this,a),this.speed=N.playerSpeed,this.couchedSpeedRatio=.5,this.fallMinAcceleration=.1,this.fallMaxAcceleration=.6,this.fallAcceleration=1.1,this.fallCurrentAcceleration=this.fallMinAcceleration,this.jumpMinAcceleration=.1,this.jumpMaxAcceleration=.6,this.jumpDeceleration=.9,this.jumpCurrentAcceleration=0,this.jumpHeight=N.playerJumpHeight,this.jumpMax=N.playerJumpMax,this.jump=!1,this.canJump=!0,this.jumpStart=0,this.jumpCount=0,this.couched=!1,this.falling=!0,this.grabbing=!1,this.canGrab=!1,this.coopJump=!1,this.alive=!0,this.stomped=!1,this.actualCollisions=[],this.cached={}}return hb(b,a),b.prototype.update=function(a){var b,c,d;if((this.alive||!(this.shape.getY()>-1*bb.getY()+bb.getHeight()))&&(this.sliding=!1,this.slowed=!1,this.testMove(0,this.shape.getY())||(this.falling=!0),this.jump||this.grabbing?this.doJump(a):this.doFall(a),d=this.couched&&!this.jump?this.speed*a*this.couchedSpeedRatio:this.speed*a,this.slowed&&(d/=2,this.canJump=!1),this.alive?(c=0,this.shape.getY()>1e3&&this.kill(),W.keys.left?(b=this.testMove(this.shape.getX()-d,0),b?this.shape.setX(b.getX()+b.getWidth()):c=-1):W.keys.right&&(b=this.testMove(this.shape.getX()+d,0),b?this.shape.setX(b.getX()-this.shape.getWidth()):c=1),W.keys.up?this.canJump&&this.startJump():this.canJump=!0,!W.keys.down||this.falling||this.jump?this.stopCouch():this.startCouch(),this.changeAnimation(this.jump?"jump":this.grabbing?"grabbing":this.falling?"fall":this.couched?0!==c?"couchMove":"couch":0!==c?"run":"idle"),this.getCornerCollisions(),-1===c&&-1!==this.skin.getScaleX()?this.changeSide(-1):1===c&&1!==this.skin.getScaleX()&&this.changeSide(1)):this.changeAnimation("dead"),this.fixSkinPos(),(this.cached.x!==this.shape.getX()||this.cached.y!==this.shape.getY()||this.cached.animation!==this.skin.getAnimation())&&(Y.sendMove(this.shape.getX(),this.shape.getY()),this.cached.x=this.shape.getX(),this.cached.y=this.shape.getY(),this.cached.animation=this.skin.getAnimation()),this.sliding))if(-1===this.skin.getScaleX()){if(b=this.testMove(this.shape.getX()-this.speed*a/2,0))return this.shape.setX(b.getX()+b.getWidth())}else if(b=this.testMove(this.shape.getX()+this.speed*a/2,0))return this.shape.setX(b.getX()-this.shape.getWidth())},b.prototype.doFall=function(a){var b,c;return 0===this.jumpCount&&(this.jumpCount=1),b=this.testMove(0,this.shape.getY()+this.fallCurrentAcceleration*a),c=this.fallCurrentAcceleration*this.fallAcceleration,this.fallCurrentAcceleration=c<=this.fallMaxAcceleration?c:this.fallMaxAcceleration,b?this.stopFall(b.getY()):this.falling=!0},b.prototype.stopFall=function(a){return this.shape.setY(a-this.shape.getHeight()),this.jumpCount=0,this.fallCurrentAcceleration=this.fallMinAcceleration,this.falling=!1},b.prototype.startJump=function(){return this.canJump=!1,this.jumpCount<this.jumpMax&&!this.couched?(this.playerCollision()&&(this.coopJump=!0,this.jumpHeight+=40),this.jumpCount++,this.jump=!0,this.jumpCurrentAcceleration=this.jumpMaxAcceleration,this.jumpStart=this.shape.getY()):void 0},b.prototype.doJump=function(a){var b,c;return this.jumpStart-this.shape.getY()<this.jumpHeight&&this.jump?(b=this.testMove(0,this.shape.getY()-this.jumpCurrentAcceleration*a),c=this.jumpCurrentAcceleration*this.jumpDeceleration,this.jumpCurrentAcceleration=c>=this.jumpMinAcceleration?c:this.jumpMinAcceleration,b&&(this.shape.setY(b.getY()+b.getHeight()),this.stopJump()),this.jumpTime+=a):this.stopJump()},b.prototype.stopJump=function(){return this.jump=!1,this.falling=!0,this.coopJump&&(this.coopJump=!1,this.jumpHeight-=40),this.stomped?this.reinitJump():void 0},b.prototype.reinitJump=function(){return this.jumpHeight=this.oldStats.jumpHeight,this.jumpMinAcceleration=this.oldStats.jumpMinAcceleration,this.jumpMaxAcceleration=this.oldStats.jumpMaxAcceleration,this.jumpDeceleration=this.oldStats.jumpDeceleration,this.stomped=!1},b.prototype.startCouch=function(){return this.couched||this.grabbing?void 0:(this.couched=!0,this.shape.setHeight(this.heightCouched),this.shape.setY(this.shape.getY()+this.height-this.heightCouched))},b.prototype.stopCouch=function(){var a;return this.couched&&(this.couched=!1,this.shape.setHeight(this.height),a=this.testMove(0,this.shape.getY()-this.height+this.heightCouched))?this.startCouch():void 0},b.prototype.getCollisions=function(){var a,b,c;return c=[],b=M.getBoundBox(this.shape),a=db.find("Sprite"),a.each(function(a){var d;return d=M.getBoundBox(a),M.colliding(b,d)?c.push(a):void 0}),a=S.find("Sprite"),a.each(function(a){var d;return d=M.getBoundBox(a),M.colliding(b,d)?c.push(a):void 0}),c},b.prototype.testMove=function(a,b){var c,d,e,f;for(0!==a&&this.shape.setX(a),0!==b&&this.shape.setY(b),d=this.getCollisions(),e=0,f=d.length;f>e;e++){if(c=d[e],void 0===c.getName()||null===c.getName())return c;if("bonus"===c.getName().type&&this.alive&&this.takeBonus(c),"boss"===c.getName().type&&this.collideBoss(c),"effect"===c.getName().type&&this.collideEffect(c),"cube"===c.getName().type||"special"===c.getName().type)return c.getName().falling&&c.getY()+c.getHeight()-16<this.shape.getY()&&this.kill(),c}return!1},b.prototype.takeBonus=function(a){return I.getBonus(a.getName().name,this),a.destroy(),S.draw(),Y.sendBonusTaken(a.getId())},b.prototype.changeAnimation=function(a){return this.skin.getAnimation()!==a?(this.skin.setAnimation(a),Y.sendAnimation(this.getIndexByAnimation(a))):void 0},b.prototype.changeSide=function(a){return b.__super__.changeSide.call(this,a),Y.sendAnimationSide(a)},b.prototype.collideBoss=function(){return this.kill()},b.prototype.collideEffect=function(a){return"ice"===a.getName().name&&(this.sliding=!0),"slow"===a.getName().name?this.slowed=!0:void 0},b.prototype.getCornerCollisions=function(){var a,b,c,d;return d=this,a=0,c=M.getBoundBox(this.shape),c.left-=4,c.right+=4,b=S.find("Sprite"),b.each(function(b){var e;return!b.getName().falling&&"cube"===b.getName().type&&(e=M.getBoundBox(b),M.colliding(c,e)&&(e.left<c.left&&-1===d.skin.getScaleX()||e.left>c.left&&1===d.skin.getScaleX())&&M.collidingCorners(c,e))?d.canGrab?(d.grab(b),a++):$.find("Rect").each(function(e){var f,g;return g=$.find("#skin-"+e.getId())[0],void 0!==e.getId()&&"otherPlayer"===e.getName()&&"couch"===g.getAnimation()&&(f=M.getBoundBox(e),f.bottom+=4,M.colliding(c,f))?(d.grab(b),a++):void 0}):void 0}),0===a?this.grabbing=!1:void 0},b.prototype.playerCollision=function(){var a,b;return b=!1,a=M.getBoundBox(this.shape),$.find("Rect").each(function(c){var d,e;return void 0!==c.getId()&&(e=$.find("#skin-"+c.getId())[0],"otherPlayer"===c.getName()&&"couch"===e.getAnimation()&&(d=M.getBoundBox(c),M.colliding(a,d)))?b=!0:void 0}),b},b.prototype.grab=function(a){return this.grabbing?void 0:(this.stopJump(),this.grabbing=!0,this.jumpCount=0,this.shape.setY(a.getY()))},b.prototype.kill=function(){return this.alive?(this.alive=!1,O.play("death"),new l(this.shape.getX()-16,this.shape.getY(),D.SMALL,"blood",!0),Y.sendDie()):void 0},b}(x),F=function(a){function b(a,c,d){b.__super__.constructor.call(this,d),this.skin.setFill("white"),this.shape.setName("otherPlayer"),this.shape.setId(a),this.skin.setId("skin-"+a),this.name=new Kinetic.Text({text:c,fill:"black",fontFamily:"Calibri",fontSize:18}),$.add(this.name)}return hb(b,a),b.prototype.move=function(a,b){return this.shape.setX(a),this.shape.setY(b),this.name.setX(a),this.name.setY(b-20),this.fixSkinPos()},b.prototype.remove=function(){return this.shape.destroy(),this.skin.destroy(),this.name.destroy(),delete this},b.prototype.kill=function(){return O.play("death"),new l(this.shape.getX()-16,this.shape.getY(),D.SMALL,"blood",!0)},b}(x),D={SMALL:{x:32,y:32},MEDIUM:{x:64,y:64},LARGE:{x:128,y:128},MEDIUM_RECT:{x:64,y:32},LARGE_RECT:{x:128,y:64},LONG_RECT:{x:32,y:128}},i=function(){function a(a,b,c,d,e){this.x=a,this.y=b,this.size=c,this.spriteSheet=d,this.animation=e,this.cubesTypes={"32-32":[{x:192,y:96,width:32,height:32}],"64-64":[{x:128,y:64,width:64,height:64}],"128-128":[{x:0,y:0,width:128,height:128}],"64-32":[{x:192,y:64,width:64,height:32}],"128-64":[{x:128,y:0,width:128,height:64}],"32-128":[{x:256,y:0,width:32,height:128}],iceExplosion:[{x:0,y:0,width:64,height:64}],explosion:[{x:64,y:0,width:64,height:64}],ice:[{x:0,y:0,width:32,height:32}],explosionEffect:[{x:0,y:32,width:160,height:128},{x:160,y:32,width:160,height:128},{x:320,y:32,width:160,height:128},{x:480,y:32,width:160,height:128},{x:0,y:160,width:160,height:128},{x:160,y:160,width:160,height:128},{x:320,y:160,width:160,height:128},{x:480,y:160,width:160,height:128},{x:0,y:288,width:160,height:128},{x:160,y:288,width:160,height:128}],iceExplosionEffect:[{x:0,y:416,width:160,height:128},{x:160,y:416,width:160,height:128},{x:320,y:416,width:160,height:128},{x:480,y:416,width:160,height:128},{x:0,y:544,width:160,height:128},{x:160,y:544,width:160,height:128},{x:320,y:544,width:160,height:128},{x:480,y:544,width:160,height:128},{x:0,y:672,width:160,height:128},{x:160,y:672,width:160,height:128}],blood:[{x:160,y:0,width:64,height:64},{x:224,y:0,width:64,height:64},{x:288,y:0,width:64,height:64},{x:352,y:0,width:64,height:64},{x:416,y:0,width:64,height:64},{x:480,y:0,width:64,height:64}],slowblock:[{x:0,y:64,width:64,height:64}],slow:[{x:32,y:0,width:32,height:32}],bioExplosion:[{x:0,y:834,width:128,height:128},{x:128,y:834,width:128,height:128},{x:256,y:834,width:128,height:128},{x:384,y:834,width:128,height:128},{x:512,y:834,width:128,height:128},{x:640,y:834,width:128,height:128}],stompblock:[{x:128,y:0,width:64,height:64}],swapblock:[{x:64,y:64,width:64,height:64}],tpblock:[{x:128,y:64,width:64,height:64}],randblock:[{x:0,y:128,width:64,height:64}]},this.draw()}return a.prototype.draw=function(){return this.shape=new Kinetic.Sprite({x:this.x,y:this.y,width:this.size.x,height:this.size.y,image:O.images[this.spriteSheet],animation:this.animation,animations:this.cubesTypes,frameRate:7,index:0})},a}(),m=function(a){function b(a,c){var d,e,f;e=32*a+160,f=-1*bb.getY(),d=c.x+"-"+c.y,b.__super__.constructor.call(this,e,f,c,this.getSpriteSheet(),d),S.add(this.shape),this.shape.setName({type:"cube",falling:!0}),this.shape.draw()}return hb(b,a),b.prototype.getSpriteSheet=function(){var a;return a=["cubes_red","cubes_green","cubes_blue"],a[Math.floor(Math.random()*a.length)]},b}(i),E=function(a){function b(a,c,d){var e;e=d.x+"-"+d.y,b.__super__.constructor.call(this,a,c,d,"cubes",e),db.add(this.shape),this.shape.draw()}return hb(b,a),b}(i),C=function(a){function b(a,c,d){var e,f;e=32*a+160,f=-1*bb.getY(),this.type=d,b.__super__.constructor.call(this,e,f,c,"cubes_special",d),S.add(this.shape),this.shape.setName({type:"special",falling:!0}),this.shape.setId(d),this.shape.draw()}return hb(b,a),b}(i),j=function(a){function b(a,c,d){var e;e=d.x+"-"+d.y,b.__super__.constructor.call(this,a,c,d,this.getSpriteSheet(),e),S.add(this.shape),this.shape.setName({type:"cube"}),this.shape.draw()}return hb(b,a),b.prototype.getSpriteSheet=function(){var a;return a=["cubes_red","cubes_green","cubes_blue"],a[Math.floor(Math.random()*a.length)]},b}(i),J={speed:[{id:1,name:"speed",x:96,y:0,width:32,height:32}],jumpHeight:[{id:2,name:"jumpHeight",x:0,y:0,width:32,height:32}],doubleJump:[{id:3,name:"doubleJump",x:0,y:0,width:32,height:32}],grabbing:[{id:4,name:"grabbing",x:32,y:0,width:32,height:32}],resurection:[{id:5,name:"resurection",x:64,y:0,width:32,height:32}]},K=[{id:1,name:"speed"},{id:2,name:"jumpHeight"},{id:3,name:"doubleJump"},{id:4,name:"grabbing"},{id:5,name:"resurection"}],b=function(){function a(a,b,c){var d,e,f;for(e=0,f=K.length;f>e;e++)d=K[e],b===d.id&&(this.type=d.name);this.id=c,this.x=32*a+160,this.y=-1*bb.getY(),this.draw()}return a.prototype.draw=function(){return this.shape=new Kinetic.Sprite({x:this.x,y:this.y,width:32,height:32,image:O.images.bonus,animation:this.type,animations:J,frameRate:0,index:0,name:{type:"bonus",name:this.type,falling:!0},id:"bonus"+this.id}),S.add(this.shape)},a}(),c=function(){function a(){this.bonuses=[{name:"doubleJump",attribute:"jumpCount",value:1,time:3e3},{name:"grabbing",attribute:"canGrab",value:!0,time:1e4},{name:"resurection",attribute:"resurection"},{name:"speed",attribute:"speed",value:.03},{name:"jumpHeight",attribute:"jumpHeight",value:5}],this.timers=[]}return a.prototype.getBonus=function(a,b){var c,d,e,f,g,h,i,j;for(O.play("pickup"),i=this.bonuses,j=[],g=0,h=i.length;h>g;g++)c=i[g],a===c.name?(this.addBonus(c,b),U.addBuff(a,c.time),void 0!==c.time?(e=this,f=c,d=function(){return e.removeBonus(f,b),U.deleteBuff(a)},j.push(this.timers.push(setTimeout(d,c.time)))):j.push(void 0)):j.push(void 0);return j},a.prototype.addBonus=function(a,b){switch(a.attribute){case"speed":return b.speed+=a.value;case"jumpHeight":return b.jumpHeight+=a.value;case"jumpCount":return b.jumpMax+=a.value;case"canGrab":return b.canGrab=!0;case"resurection":return Y.sendResurection(),b.resurection()}},a.prototype.removeBonus=function(a,b){switch(a.attribute){case"speed":return b.speed-=a.value;case"jumpHeight":return b.jumpHeight-=a.value;case"jumpCount":return b.jumpMax-=a.value;case"canGrab":return b.canGrab=!1}},a.prototype.reset=function(){var a,b,c,d,e;for(d=this.timers,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(clearInterval(a));return e},a.prototype.remove=function(a){var b;return b=S.find("Sprite"),b.each(function(b){return b.getId()===a?(b.destroy(),S.draw()):void 0})},a}(),u=function(){function a(){this.tweens=[],this.level=0,this.levelHeight=0}return a.prototype.reset=function(){var a,b,c,d;for(d=this.tweens,b=0,c=d.length;c>b;b++)a=d[b],void 0!==a&&a.destroy();return bb.setY(0),cb.setY(0),V.setY(0),H.reset(),I.reset(),L.reset(),U.reset(),S.destroyChildren(),bb.draw(),this.level=0,this.levelHeight=0},a.prototype.moveLevel=function(a){return H.add(a/32),this.levelHeight+=a,this.tweens[0]=new Kinetic.Tween({node:bb,duration:2,y:bb.getY()+a,onFinish:function(){return Y.sendMoveLevelOk()}}),this.tweens[0].play(),this.tweens[1]=new Kinetic.Tween({node:cb,duration:2,y:cb.getY()-a}),this.tweens[1].play(),this.tweens[2]=new Kinetic.Tween({node:V,duration:2,y:V.getY()-a}),this.tweens[2].play()},a.prototype.clearLevel=function(){var a;return this.level++,a=S.find("Sprite"),a.each(function(a){return a.getY()>-1*bb.getY()+bb.getHeight()||"bonus"===a.getName().type?a.destroy():void 0}),Z.shape.getY()>-1*bb.getY()+bb.getHeight()&&Z.kill(),H.clearOutOfScreen(),P.convertToStatic()},a}(),k=function(){function a(){this.speed=.4}return a.prototype.reinitAllPhys=function(){var a;return a=S.find("Sprite"),a.each(function(a){var b;return"cube"===a.getName().type?(b=a.getName(),(null===b||void 0===b)&&(b={}),b.falling=!0,a.setName(b)):void 0})},a.prototype.reinitPhys=function(a){var b;return b=S.find("Sprite"),b.each(function(b){var c;return"cube"===b.getName().type&&b.getY()<a.getY()&&b.getX()>=a.getX()&&b.getX()<=a.getX()+a.getWidth()?(c=b.getName(),(null===c||void 0===c)&&(c={}),c.falling=!0,b.setName(c)):void 0})},a.prototype.update=function(a){var b,c;return c=this,b=S.find("Sprite"),b.each(function(b){var d,e;if(void 0!==b.getName()&&null!==b.getName()&&b.getName().falling){if(d=c.testMove(b,b.getY()+c.speed*a),!d)return b.setY(b.getY()+.1*a);if(b.setY(d.getY()-b.getHeight()),e=b.getName(),(null===e||void 0===e)&&(e={}),e.falling=!1,b.setName(e),c.reinitPhys(b),void 0!==b.getId())return c.doEffect(b,b.getId())}})},a.prototype.getCollisions=function(a){var b,c,d;return c=[],d=M.getBoundBox(a),b=db.find("Sprite"),b.each(function(a){var b;return b=M.getBoundBox(a),M.colliding(d,b)?c.push(a):void 0}),b=S.find("Sprite"),b.each(function(b){var e;return a._id!==b._id&&void 0!==b.getName()&&null!==b.getName()&&"cube"===b.getName().type&&(e=M.getBoundBox(b),M.colliding(d,e))?c.push(b):void 0}),c},a.prototype.testMove=function(a,b){var c,d,e,f;for(a.setY(b),d=this.getCollisions(a),e=0,f=d.length;f>e;e++)return c=d[e];return!1},a.prototype.convertToStatic=function(){var a;return a=S.find("Sprite"),a.each(function(a){return"cube"===a.getName().type?(a.moveTo(db),a.draw()):void 0})},a.prototype.doEffect=function(a,b){var c,d;return"iceExplosion"===b&&this.iceExplosionEffect(a),"explosion"===b&&this.explosionEffet(a),"slowblock"===b&&this.slowExplosionEffet(a),"stompblock"===b&&this.stompEffet(a),"swapblock"===b&&this.swapEffet(a),"tpblock"===b&&this.tpEffet(a),"randblock"===b?(c=["iceExplosion","explosion","slowblock","swapblock","tpblock"],d=Math.floor(Math.random()*c.length),this.doEffect(a,c[d])):void 0},a.prototype.iceExplosionEffect=function(a){return O.play("explosion"),new l(a.getX()-a.getWidth()/2-16,a.getY()-a.getHeight()/2-32,D.SMALL,"iceExplosionEffect",!0),db.find("Sprite").each(function(b){var c,d,e,f;if(b.getX()<a.getX()+128&&b.getX()>a.getX()-96&&b.getY()<a.getY()+128&&b.getY()>a.getY()-128){for(f=[],c=d=0,e=b.getWidth()/32-1;e>=0?e>=d:d>=e;c=e>=0?++d:--d)f.push(new l(b.getX()+32*c,b.getY()-2,D.SMALL,"ice"));return f}}),S.find("Sprite").each(function(b){var c,d,e,f;if(!b.getName().falling&&"cube"===b.getName().type&&b.getX()<a.getX()+128&&b.getX()>a.getX()-96&&b.getY()<a.getY()+128&&b.getY()>a.getY()-128){for(f=[],c=d=0,e=b.getWidth()/32-1;e>=0?e>=d:d>=e;c=e>=0?++d:--d)f.push(new l(b.getX()+32*c,b.getY()-2,D.SMALL,"ice"));return f}}),a.destroy()},a.prototype.slowExplosionEffet=function(a){return O.play("death"),new l(a.getX()-a.getWidth()/2,a.getY()-a.getHeight()/2,D.SMALL,"bioExplosion",!0),db.find("Sprite").each(function(b){var c,d,e,f;if(b.getX()<a.getX()+96&&b.getX()>a.getX()-64&&b.getY()<a.getY()+128&&b.getY()>a.getY()-128){for(f=[],c=d=0,e=b.getWidth()/32-1;e>=0?e>=d:d>=e;c=e>=0?++d:--d)f.push(new l(b.getX()+32*c,b.getY()-2,D.SMALL,"slow"));return f}}),S.find("Sprite").each(function(b){var c,d,e,f;if(!b.getName().falling&&"cube"===b.getName().type&&b.getX()<a.getX()+96&&b.getX()>a.getX()-64&&b.getY()<a.getY()+128&&b.getY()>a.getY()-128){for(f=[],c=d=0,e=b.getWidth()/32-1;e>=0?e>=d:d>=e;c=e>=0?++d:--d)f.push(new l(b.getX()+32*c,b.getY()-2,D.SMALL,"slow"));return f}}),a.destroy()},a.prototype.explosionEffet=function(a){var b;return O.play("explosion"),new l(a.getX()-a.getWidth()/2-16,a.getY()-a.getHeight()/2-32,D.SMALL,"explosionEffect",!0),b=[],S.find("Sprite").each(function(a){var c,d,e,f,g,h;if(!a.getName().falling&&"cube"===a.getName().type&&(a.getWidth()>32||a.getHeight()>32)){for(c=e=0,g=a.getWidth()/32-1;g>=0?g>=e:e>=g;c=g>=0?++e:--e)for(d=f=0,h=a.getHeight()/32-1;h>=0?h>=f:f>=h;d=h>=0?++f:--f)void 0===b[a.getX()+32*c+"_"+a.getY()+32*d]&&(b[a.getX()+32*c+"_"+a.getY()+32*d]=1,new j(a.getX()+32*c,a.getY()+32*d,D.SMALL));return a.destroy()}}),S.find("Sprite").each(function(b){var c,d,e,f;for(f=[],c=e=-4;5>=e;c=++e)d=c,c>0&&(d=c-1),f.push(b.getX()===a.getX()+32*c&&b.getY()<a.getY()-32*(-5+Math.abs(d))&&b.getY()>a.getY()+32*(-5+Math.abs(d))?b.destroy():void 0);return f}),Z.shape.getX()<a.getX()+96&&Z.shape.getX()>a.getX()-96&&Z.shape.getY()<a.getY()+96&&Z.shape.getY()>a.getY()-96&&Z.kill(),this.reinitAllPhys()},a.prototype.stompEffet=function(a){return O.play("explosion"),Z.jump||(Z.oldStats={jumpHeight:Z.jumpHeight,jumpMinAcceleration:Z.jumpMinAcceleration,jumpMaxAcceleration:Z.jumpMaxAcceleration,jumpDeceleration:Z.jumpDeceleration},Z.jumpStart=Z.shape.getY(),Z.jumpHeight=300,Z.jumpMinAcceleration=.1,Z.jumpMaxAcceleration=1.5,Z.jumpCurrentAcceleration=Z.jumpMaxAcceleration,Z.jumpDeceleration=.92,Z.jumpCount=Z.jumpMax,Z.stomped=!0,Z.jump=!0),a.destroy()},a.prototype.swapEffet=function(a){var b,c;return O.play("explosion"),b=[],$.find("Rect").each(function(a){var c;return a._id!==Z.shape._id&&(c=$.find("#skin-"+a.getId())[0],"dead"!==c.getAnimation())?b.push({x:a.getX(),y:a.getY()}):void 0}),b.length>0&&(c=Math.floor(Math.random()*b.length),Z.shape.setX(b[c].x),Z.shape.setY(b[c].y)),a.destroy()},a.prototype.tpEffet=function(a){var b;return O.play("explosion"),b={x:a.getX()+16,y:a.getY()},a.destroy(),Z.shape.setX(b.x),Z.shape.setY(b.y)},a}(),w=function(){function a(){this.players=[],this.playersId=[]}return a.prototype.connect=function(a,b,c){return this.socket=io.connect("http://"+a+":8080"),this.socket.emit("login",[b,c]),this.listener()},a.prototype.listener=function(){var a;return a=this,this.socket.on("fallingCube",function(a){return new m(a[0],a[1])}),this.socket.on("fallingBonus",function(a){return new b(a[0],a[1],a[2])}),this.socket.on("fallingSpecial",function(a){return new C(a[0],a[1],a[2])}),this.socket.on("resetLevel",function(){return X.reset(),Z.reset()}),this.socket.on("clearLevel",function(){return X.clearLevel()}),this.socket.on("moveLevel",function(a){return X.moveLevel(a)}),this.socket.on("bonusTaken",function(a){return I.remove(a)}),this.socket.on("connection",function(b){return a.players[b[0]]=new F(b[0],b[1],b[2]),a.playersId.push(b[0])}),this.socket.on("disconnect",function(b){return a.players[b].remove()}),this.socket.on("move",function(b){return void 0!==a.players[b[0]]?a.players[b[0]].move(b[1],b[2]):void 0}),this.socket.on("changeAnimation",function(b){return void 0!==a.players[b[0]]?a.players[b[0]].changeAnimation(b[1]):void 0}),this.socket.on("changeAnimationSide",function(b){return void 0!==a.players[b[0]]?a.players[b[0]].changeSide(b[1]):void 0}),this.socket.on("kill",function(b){return a.players[b].kill()
}),this.socket.on("spawnBoss",function(a){return L.spawn(a[0],a[1])}),this.socket.on("resurection",function(){return Z.resurection()}),this.socket.on("debugMap",function(a){return N.debug?debugMap(a):void 0}),this.socket.on("playerList",function(b){var c,d,e,f,g,h;for(g=a.playersId,h=[],c=e=0,f=g.length;f>e;c=++e)d=g[c],-1===b.indexOf(d)?(void 0!==a.players[d]&&a.players[d].remove(),h.push(a.playersId.splice(c,1))):h.push(void 0);return h}),this.socket.on("message",function(b){return T.addMessage(a.players[b[0]].name.getText(),b[1])})},a.prototype.sendLaunch=function(){return this.socket.emit("launch")},a.prototype.sendReset=function(){return this.socket.emit("reset")},a.prototype.sendMove=function(a,b){return this.socket.emit("move",[parseInt(a),parseInt(b)])},a.prototype.sendDie=function(){return this.socket.emit("die")},a.prototype.sendMoveLevelOk=function(){return this.socket.emit("moveLevelOk")},a.prototype.sendBonusTaken=function(a){return this.socket.emit("bonusTaken",a)},a.prototype.sendAnimation=function(a){return this.socket.emit("changeAnimation",a)},a.prototype.sendAnimationSide=function(a){return this.socket.emit("changeAnimationSide",a)},a.prototype.sendBossBeaten=function(){return this.socket.emit("bossBeaten")},a.prototype.sendResurection=function(){return this.socket.emit("resurection")},a.prototype.sendMessage=function(a){return this.socket.emit("message",a)},a}(),B=function(){function a(){this.parts=["skin","hair","head","body","leg","shoes"],this.skins=[],this.callback=[]}return a.prototype.createSkin=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;for(this.callback[c]=b,h=this,d=0,e=[],f=null,l=this.parts,m=[],j=0,k=l.length;k>j;j++)g=l[j],i=new Image,i.src="../assets/player/"+g+"/"+a[g]+".png",e.push(i),m.push(i.onload=function(){return d++,d===h.parts.length?h.createSheet(e,c):void 0});return m},a.prototype.createSheet=function(a,b){var c,d,e,f,g,h;for(d=this,f=new Kinetic.Layer,bb.add(f),g=0,h=a.length;h>g;g++)c=a[g],e=new Kinetic.Image({image:c}),f.add(e);return f.toImage({callback:function(a){return d.callback[b](a),delete d.callback[b]}}),f.destroy()},a}(),a=function(){function a(){this.y=bb.getHeight()-32,this.initHeight=32,this.height=this.initHeight,this.draw()}return a.prototype.draw=function(){var a,b,c,d,e;for(a=b=0;13>=b;a=++b)new E(32*a+128,this.y,D.SMALL);for(e=[],a=c=0,d=this.height;d>=0?d>=c:c>=d;a=d>=0?++c:--c)new E(128,this.y-32*a,D.SMALL),e.push(new E(544,this.y-32*a,D.SMALL));return e},a.prototype.reset=function(){return this.height=this.initHeight,this.clear(),this.draw()},a.prototype.clear=function(){var a;return a=db.find("Sprite"),a.each(function(a){return a.remove()}),db.draw()},a.prototype.add=function(a){var b,c,d,e;for(b=c=d=this.height,e=this.height+a;e>=d?e>=c:c>=e;b=e>=d?++c:--c)new E(128,this.y-32*b,D.SMALL),new E(544,this.y-32*b,D.SMALL);return this.height+=a},a.prototype.clearOutOfScreen=function(){var a;return a=db.find("Sprite"),a.each(function(a){return a.getY()>-1*bb.getY()+bb.getHeight()?a.destroy():void 0})},a}(),q=function(){function a(){this.level,this.buffs=[],this.drawLevel()}return a.prototype.update=function(a){var b;return b="Level : "+X.level,b!==this.level.getText()&&this.level.setText(b),this.updateBuffs(a),V.draw()},a.prototype.drawLevel=function(){return this.level=new Kinetic.Text({text:"Level : 0",fill:"black",fontFamily:"Calibri",fontSize:18}),V.add(this.level)},a.prototype.addBuff=function(a,b){var c,d,e;if("resurection"!==a){if(this.buffs.push({buff:a,time:b}),void 0===V.find("#"+a)[0])return c=new Kinetic.Sprite({x:618,y:0,width:32,height:32,image:O.images.bonus,animation:a,animations:J,frameRate:0,index:0,id:a}),V.add(c),void 0!==b&&(e=new Kinetic.Text({x:658,y:0,text:b/1e3,fill:"black",fontFamily:"Calibri",fontSize:18,id:"timer"+a,name:"timer"}),V.add(e),e.setAttr("currentTime",b/1e3)),d=new Kinetic.Text({x:590,y:0,text:"1 x ",fill:"black",fontFamily:"Calibri",fontSize:18,id:"count"+a,name:"count"}),V.add(d);if(d=V.find("#count"+a)[0],d.setText(parseInt(d.getText().split(" x "))+1+" x "),void 0!==b)return e=V.find("#timer"+a)[0],e.setText(b/1e3)}},a.prototype.deleteBuff=function(a){var b,c,d;if(b=V.find("#"+a)[0],c=V.find("#count"+a)[0],d=V.find("#timer"+a)[0],void 0!==b)if(void 0!==c){if("1 x "!==c.getText())return c.setText(parseInt(c.getText().split(" x "))-1+" x ");if(b.destroy(),c.destroy(),void 0!==d)return d.destroy()}else if(b.destroy(),c.destroy(),void 0!==d)return d.destroy()},a.prototype.updateBuffs=function(a){var b;return b=0,V.find("Sprite").each(function(a){var c,d;return d=V.find("#timer"+a.getId())[0],void 0!==d&&d.setY(b+8),c=V.find("#count"+a.getId())[0],void 0!==c&&c.setY(b+8),a.setY(b),b+=40}),V.find("Text").each(function(b){var c;return"timer"===b.getName()?(c=b.getAttr("currentTime")-a/1e3,0>c&&(c=0),b.setAttr("currentTime",c),b.setText(Math.round(100*c)/100)):void 0})},a.prototype.reset=function(){return V.find("Text").each(function(a){return"timer"===a.getName()||"count"===a.getName()?a.destroy():void 0}),V.find("Sprite").each(function(a){return a.destroy()})},a}(),l=function(a){function b(a,c,d,e,f){var g,h;b.__super__.constructor.call(this,a,c,d,"effects",e),S.add(this.shape),this.shape.setName({type:"effect",name:e}),this.shape.draw(),"explosionEffect"===e||"iceExplosionEffect"===e?this.shape.setFrameRate(20):("blood"===e||"bioExplosion"===e)&&this.shape.setFrameRate(16),this.shape.start(),void 0!==f&&(h=this,g=this.shape.getAnimations()[this.shape.getAnimation()].length-1,this.shape.afterFrame(g,function(){return h.shape.destroy()}))}return hb(b,a),b}(i),d=function(){function a(a,b,c,d,e){this.type=a,this.x=b,this.y=c,this.w=d,this.h=e,this.bossTypes={roueman:[{x:0,y:0,width:63,height:64},{x:64,y:0,width:63,height:64},{x:128,y:0,width:63,height:64}],freezeman:[{x:0,y:65,width:544,height:32}],poingman:[{x:256,y:0,width:64,height:64}],labiman:[{x:192,y:0,width:64,height:64}]},this.draw()}return a.prototype.draw=function(){return this.shape=new Kinetic.Sprite({x:this.x,y:this.y,width:this.w,height:this.h,image:O.images.boss,animation:this.type,animations:this.bossTypes,frameRate:10,index:0,name:{type:"boss",name:this.type},stroke:"black",strokeWidth:1,strokeEnabled:!0}),S.add(this.shape),this.shape.start()},a.prototype.finish=function(){return L.stopUpdate(),this.shape.destroy(),Y.sendBossBeaten()},a.prototype.reset=function(){return this.shape.destroy()},a}(),v=function(a){function b(a,c,d,e,f){b.__super__.constructor.call(this,a,c,d,e,f),this.parts=[]}return hb(b,a),b.prototype.reset=function(){var a,c,d,e,f;for(b.__super__.reset.call(this),e=this.parts,f=[],c=0,d=e.length;d>c;c++)a=e[c],f.push(a.reset());return f},b.prototype.finish=function(){return this.reset(),L.stopUpdate(),Y.sendBossBeaten()},b}(d),e=function(){function a(){this.currentBoss}return a.prototype.spawn=function(a,b){return 1===a&&(this.currentBoss=new A(b)),2===a&&(this.currentBoss=new n(b)),3===a&&(this.currentBoss=new y(b)),4===a?this.currentBoss=new s(b):void 0},a.prototype.reset=function(){return this.stopUpdate(),void 0!==this.currentBoss?this.currentBoss.reset():void 0},a.prototype.update=function(){},a.prototype.stopUpdate=function(){return this.update=function(){}},a}(),A=function(a){function b(a){var c;c=-1*bb.getY(),b.__super__.constructor.call(this,"roueman",0,c,64,64),this.attacks=a[1],this.attackIndex=0,this.attackSpeed=a[0],this.start()}return hb(b,a),b.prototype.start=function(){return this.moveY(H.y-X.levelHeight-128,"+","next")},b.prototype.moveX=function(a,b,c){var d;return d=this,L.update=function(e){var f;return"+"===b?f=d.shape.getX()+e*d.attackSpeed:"-"===b&&(f=d.shape.getX()-e*d.attackSpeed),"+"===b&&a>f||"-"===b&&f>a?d.shape.setX(f):(d.shape.setX(a),"return"===c?d.moveY(H.y-X.levelHeight-128,"-","return"):"next"===c?d.next():void 0)}},b.prototype.moveY=function(a,b,c){var d;return d=this,L.update=function(e){var f;return"+"===b?f=d.shape.getY()+e*d.attackSpeed:"-"===b&&(f=d.shape.getY()-e*d.attackSpeed),"+"===b&&a>f||"-"===b&&f>a?d.shape.setY(f):(d.shape.setY(a),"attack"===c?d.moveX(N.levelWidth-64,"+","return"):"return"===c?d.moveX(0,"-","next"):"next"===c?d.next():void 0)}},b.prototype.next=function(){var a;return a=this.attacks[this.attackIndex],void 0!==a?(this.moveY(H.y-X.levelHeight-32*a,"+","attack"),this.attackIndex++):this.finish()},b}(d),n=function(){function a(a){this.speed=a[0][0],this.counter=0,this.interval=a[0][1],this.attacks=a[1],this.attackIndex=0,this.count=0,this.parts=[],this.levelHeight=H.y-X.levelHeight,this.start(),this.next()}return a.prototype.start=function(){var a,b,c;for(a=c=5;16>=c;a=++c)new l(32*a,this.levelHeight-4,D.SMALL,"ice");return b=this,L.update=function(c){var d,e,f,g,h,i;for(b.counter+=c,b.counter>=b.interval&&(b.counter=0,b.next()),e=c*b.speed,i=b.parts,a=g=0,h=i.length;h>g;a=++g)d=i[a],void 0!==d&&(f=d.shape.getY()+e,f<b.levelHeight?d.shape.setY(f):(d.shape.destroy(),b.parts[a]=null,b.count++,b.count===2*b.attacks.length&&b.finish()));return b.parts=b.parts.filter(function(a){return a})}},a.prototype.next=function(){var a;return a=this.attacks[this.attackIndex],void 0!==a?(this.parts.push(new o(32*a[0]+128)),this.parts.push(new o(32*a[1]+128)),this.attackIndex++):void 0},a.prototype.reset=function(){var a,b,c,d,e;for(d=this.parts,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.reset());return e},a.prototype.finish=function(){return L.stopUpdate(),Y.sendBossBeaten()},a}(),o=function(a){function b(a){var c;c=-1*bb.getY(),b.__super__.constructor.call(this,"freezeman",a,c,544,32)}return hb(b,a),b}(d),y=function(a){function b(a){var c;c=900,this.levelHeight=H.y-X.levelHeight,this.y=this.levelHeight-256,b.__super__.constructor.call(this,"poingman",c,this.y,64,64),this.attacking=!1,this.comeBack=!1,this.finishing=!1,this.starting=!0,this.waiting=!1,this.time=0,this.speed=a[0][0],this.attackSpeed=a[0][1],this.waitTime=a[0][2],this.attacks=a[1],this.index=0,this.oldPos=0,this.start()}return hb(b,a),b.prototype.start=function(){var a;return a=this,this.parts.push(new z(0,this.levelHeight-64)),this.parts.push(new z(640,this.levelHeight-64)),L.update=function(b){return!a.attacking||a.finishing||a.starting||a.waiting?a.finishing||a.starting||a.waiting?a.starting||a.waiting?a.waiting?a.wait(b):a.startingPhase(b):a.finishingPhase(b):a.moveToPosition(b):a.attack(b)}},b.prototype.moveToPosition=function(a){var b,c;return b=32*this.attacks[this.index]+160,this.shape.getX()>=b&&this.oldPos>=b?(c=this.shape.getX()-this.speed*a,b>c?(this.shape.setX(b),this.oldPos=this.shape.getX(),this.attacking=!0):this.shape.setX(c)):this.shape.getX()<b&&this.oldPos<b?(c=this.shape.getX()+this.speed*a,c>b?(this.shape.setX(b),this.oldPos=this.shape.getX(),this.attacking=!0):this.shape.setX(c)):void 0},b.prototype.attack=function(a){var b,c,d,e,f,g;if(d=this.levelHeight-62,this.shape.getY()<d&&!this.comeBack)return e=this.shape.getY()+this.attackSpeed*a,this.shape.setY(e>d?d:e);if(this.shape.getY()>this.y&&this.comeBack)return e=this.shape.getY()-this.attackSpeed*a,this.shape.setY(e<this.y?this.y:e);if(!this.comeBack){for(O.play("explosion"),this.comeBack=!0,c=P.getCollisions(this.shape),f=0,g=c.length;g>f;f++)b=c[f],b.destroy();return db.draw()}return this.index++,this.attacking=!1,this.comeBack=!1,this.waiting=!0,void 0===this.attacks[this.index]?(this.finishing=!0,this.regenMap()):void 0},b.prototype.startingPhase=function(a){var b;return b=this.parts[0].shape.getX()+this.speed*a,this.parts[0].shape.setX(b>128?128:b),b=this.parts[1].shape.getX()-this.speed*a,this.parts[1].shape.setX(512>b?512:b),this.shape.setX(this.shape.getX()-this.speed*a),this.shape.getX()<64?this.starting=!1:void 0},b.prototype.finishingPhase=function(a){return this.parts[0].shape.setX(this.parts[0].shape.getX()-this.speed*a),this.parts[1].shape.setX(this.parts[1].shape.getX()+this.speed*a),this.shape.setX(this.shape.getX()+this.speed*a),this.shape.getX()>800?this.finish():void 0},b.prototype.regenMap=function(){var a,b,c;for(c=[],a=b=1;12>=b;a=++b)c.push(new E(32*a+128,this.levelHeight,D.SMALL));return c},b.prototype.wait=function(a){return this.time+=a,this.time>=this.waitTime?(this.time=0,this.waiting=!1):void 0},b}(v),z=function(a){function b(a,c){b.__super__.constructor.call(this,"roueman",a,c,64,64),this.attached=!0}return hb(b,a),b}(d),s=function(a){function b(){var a,c;this.levelHeight=H.y-X.levelHeight,a=256,c=-1*bb.getY(),this.oldPos={x:a,y:c},b.__super__.constructor.call(this,"labiman",a,c,64,64),this.attacks=this.makeLevel(),this.maxHeight=this.getMaxHeight(),this.speed=.3,this.attackSpeed=.05,this.waiting=!1,this.attacking=!1,this.count=0,this.index=0,this.start()}return hb(b,a),b.prototype.makeLevel=function(){var a,b,c;for(b=[],b.push([Math.floor(10*Math.random()),2]),a=c=0;10>=c;a=++c)b.push(this.nextPossibility(b));return b},b.prototype.nextPossibility=function(a){var b,c,d,e,f;for(b=a[a.length-1],f=a[a.length-2],e=[],1===a.length?e=[[2,2],[-2,2]]:b[1]===f[1]+1?b[0]>=f[0]?e.push([1,2],[2,2],[-2,2]):e.push([-1,2],[-2,2],[2,2]):b[0]>=f[0]?e.push([1,2],[2,2],[-2,2]):e.push([-1,2],[-2,2],[2,2]);;)if(d=Math.floor(Math.random()*e.length),c=[b[0]+e[d][0],b[1]+e[d][1]],c[0]>=0&&c[0]<=10)break;return c},b.prototype.getMaxHeight=function(){var a,b,c,d,e;for(b=0,e=this.attacks,c=0,d=e.length;d>c;c++)a=e[c],a[1]>b&&(b=a[1]);return b},b.prototype.start=function(){var a;return a=this,this.parts.push(new t),L.update=function(b){return a.waiting?a.bossEscape(b):a.moveToPosition(b),a.attacking?a.attack(b):void 0}},b.prototype.moveToPosition=function(a){var b,c,d;return b=32*this.attacks[this.index][0]+160,this.shape.getX()>b&&this.oldPos.x>b?(d=this.shape.getX()-this.speed*a,b>d?(this.shape.setX(b),this.oldPos.x=this.shape.getX()):this.shape.setX(d)):this.shape.getX()<b&&this.oldPos.x<b&&(d=this.shape.getX()+this.speed*a,d>b?(this.shape.setX(b),this.oldPos.x=this.shape.getX()):this.shape.setX(d)),c=this.levelHeight-32*this.attacks[this.index][1],this.shape.getY()>c&&this.oldPos.y>c?(d=this.shape.getY()-this.speed*a,c>d?(this.shape.setY(c),this.oldPos.y=this.shape.getY()):this.shape.setY(d)):this.shape.getY()<c&&this.oldPos.y<c&&(d=this.shape.getY()+this.speed*a,d>c?(this.shape.setY(c),this.oldPos.y=this.shape.getY()):this.shape.setY(d)),this.shape.getY()===c&&this.shape.getX()===b&&(this.index++,this.count++,this.placeBlock(),void 0===this.attacks[this.index]&&(this.waiting=!0),5===this.count)?this.attacking=!0:void 0},b.prototype.attack=function(a){var b,c;return c=this.parts[0].shape.getY()-this.attackSpeed*a,b=this.levelHeight-32*this.maxHeight+8,c>b?this.parts[0].shape.setY(c):(this.parts[0].shape.setY(b),this.finish())},b.prototype.placeBlock=function(){return new j(this.shape.getX(),this.shape.getY(),D.SMALL)},b.prototype.bossEscape=function(a){var b;return b=this.shape.getX()+this.speed*a,800>b?this.shape.setX(b):void 0},b.prototype.finish=function(){return b.__super__.finish.call(this),S.find("Sprite").each(function(a){return a.destroy()})},b}(v),t=function(a){function b(){var a;a=H.y-X.levelHeight+32,b.__super__.constructor.call(this,"freezeman",80,a,544,32)}return hb(b,a),b}(d),bb=new Kinetic.Stage({container:"container",width:N.levelWidth,height:N.levelHeight}),S=new Kinetic.Layer,$=new Kinetic.Layer,db=new Kinetic.Layer,cb=new Kinetic.Layer,V=new Kinetic.Layer,bb.add(cb),bb.add($),bb.add(db),bb.add(S),bb.add(V),Y=new w,O=new g,M=new f,W=new r,X=new u,I=new c,L=new e,P=new k,ab=new B,T=new p,T.loadAssets(),H=null,Z=null,U=null,_={body:1,hair:1,head:1,leg:1,shoes:1,skin:1},O.contentsLoaded=function(){var b;return document.querySelector("#login-form").style.display="block",document.querySelector("#login-loading").style.display="none",O.playSong(),b=function(b,c){var d,e,f,g;return d=new Kinetic.Rect({width:bb.getWidth(),height:bb.getHeight(),fillPatternImage:O.images.bg}),cb.add(d),d.setZIndex(-1),d.draw(),H=new a,Z=new h(_),U=new q,Y.connect(b,c,_),T.update=function(a){return $.draw(),S.draw(),Z.update(a),L.update(a),U.update(a),P.update(a)},T.start(),N.debug?(e=new Kinetic.Layer,bb.add(e),e.setZIndex(100),f=function(a){var b,c,d,f,g,h,i,j,k;for(e.destroyChildren(),f=h=0,j=a.length;j>h;f=++h)for(c=a[f],g=i=0,k=c.length;k>i;g=++i)d=c[g],null!==d&&(b=new Kinetic.Rect({x:32*f+160,y:H.y-32*g-32,width:32,height:32,stroke:"red"}),e.add(b));return e.draw()},g=function(){return L.spawn(4,[])},setTimeout(g,1e3)):void 0},document.querySelector("#play").onclick=function(){return document.querySelector("#login").style.display="none",b(document.querySelector("#ip").value.replace(" ",""),document.querySelector("#name").value),O.play("beep")}},window.onresize=function(){return T.resize()},document.querySelector("#sound-mute-effect").onclick=function(){return this.className="muted",O.muteEffect()},document.querySelector("#sound-mute-music").onclick=function(){return this.className="muted",O.muteMusic()},document.querySelector("#sound-add-effect").onclick=function(){return O.addVolumeEffect()},document.querySelector("#sound-add-music").onclick=function(){return O.addVolumeMusic()},document.querySelector("#sound-sub-effect").onclick=function(){return O.lessVolumeEffect()},document.querySelector("#sound-sub-music").onclick=function(){return O.lessVolumeMusic()},R=document.querySelectorAll("#skin-control div a"),eb=0,fb=R.length;fb>eb;eb++)Q=R[eb],Q.onclick=function(a){var b,c;return O.play("beep"),a.preventDefault(),b=document.querySelector("#skin-preview ."+this.getAttribute("data-type")),c=""===b.style.background?2:parseInt(b.style.background.split("/")[4].split(".png")[0])+parseInt(this.getAttribute("data-add")),1>c?c=N.skins[this.getAttribute("data-type")]:c>N.skins[this.getAttribute("data-type")]&&(c=1),b.style.background='url("../assets/player/'+this.getAttribute("data-type")+"/"+c+'.png") 140px 0',_[this.getAttribute("data-type")]=c}}).call(this);